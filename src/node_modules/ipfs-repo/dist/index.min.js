(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsRepo = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var IpfsRepo=(()=>{var Eh=Object.create;var kn=Object.defineProperty;var Dh=Object.getOwnPropertyDescriptor;var xh=Object.getOwnPropertyNames;var _h=Object.getPrototypeOf,Ah=Object.prototype.hasOwnProperty;var C=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),R=(r,e)=>{for(var t in e)kn(r,t,{get:e[t],enumerable:!0})},La=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of xh(e))!Ah.call(r,o)&&o!==t&&kn(r,o,{get:()=>e[o],enumerable:!(n=Dh(e,o))||n.enumerable});return r};var S=(r,e,t)=>(t=r!=null?Eh(_h(r)):{},La(e||!r||!r.__esModule?kn(t,"default",{value:r,enumerable:!0}):t,r)),Ch=r=>La(kn({},"__esModule",{value:!0}),r);var Ma=C((ab,Fa)=>{var Kt=1e3,Wt=Kt*60,Ht=Wt*60,xt=Ht*24,Th=xt*7,Ih=xt*365.25;Fa.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return Oh(r);if(t==="number"&&isFinite(r))return e.long?kh(r):Ph(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Oh(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!!e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*Ih;case"weeks":case"week":case"w":return t*Th;case"days":case"day":case"d":return t*xt;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ht;case"minutes":case"minute":case"mins":case"min":case"m":return t*Wt;case"seconds":case"second":case"secs":case"sec":case"s":return t*Kt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Ph(r){var e=Math.abs(r);return e>=xt?Math.round(r/xt)+"d":e>=Ht?Math.round(r/Ht)+"h":e>=Wt?Math.round(r/Wt)+"m":e>=Kt?Math.round(r/Kt)+"s":r+"ms"}function kh(r){var e=Math.abs(r);return e>=xt?Nn(r,e,xt,"day"):e>=Ht?Nn(r,e,Ht,"hour"):e>=Wt?Nn(r,e,Wt,"minute"):e>=Kt?Nn(r,e,Kt,"second"):r+" ms"}function Nn(r,e,t,n){var o=e>=t*1.5;return Math.round(r/t)+" "+n+(o?"s":"")}});var Ua=C((cb,$a)=>{function Nh(r){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=o,t.enabled=s,t.humanize=Ma(),t.destroy=f,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let l=0;for(let p=0;p<u.length;p++)l=(l<<5)-l+u.charCodeAt(p),l|=0;return t.colors[Math.abs(l)%t.colors.length]}t.selectColor=e;function t(u){let l,p=null,g,h;function m(..._){if(!m.enabled)return;let T=m,B=Number(new Date),$=B-(l||B);T.diff=$,T.prev=l,T.curr=B,l=B,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let k=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(Q,L)=>{if(Q==="%%")return"%";k++;let V=t.formatters[L];if(typeof V=="function"){let Te=_[k];Q=V.call(T,Te),_.splice(k,1),k--}return Q}),t.formatArgs.call(T,_),(T.log||t.log).apply(T,_)}return m.namespace=u,m.useColors=t.useColors(),m.color=t.selectColor(u),m.extend=n,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(g!==t.namespaces&&(g=t.namespaces,h=t.enabled(u)),h),set:_=>{p=_}}),typeof t.init=="function"&&t.init(m),m}function n(u,l){let p=t(this.namespace+(typeof l>"u"?":":l)+u);return p.log=this.log,p}function o(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let l,p=(typeof u=="string"?u:"").split(/[\s,]+/),g=p.length;for(l=0;l<g;l++)!p[l]||(u=p[l].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){let u=[...t.names.map(a),...t.skips.map(a).map(l=>"-"+l)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let l,p;for(l=0,p=t.skips.length;l<p;l++)if(t.skips[l].test(u))return!1;for(l=0,p=t.names.length;l<p;l++)if(t.names[l].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}$a.exports=Nh});var Me=C((he,Bn)=>{he.formatArgs=Rh;he.save=Lh;he.load=Fh;he.useColors=Bh;he.storage=Mh();he.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();he.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Bh(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Rh(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Bn.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(n=t))}),r.splice(n,0,e)}he.log=console.debug||console.log||(()=>{});function Lh(r){try{r?he.storage.setItem("debug",r):he.storage.removeItem("debug")}catch{}}function Fh(){let r;try{r=he.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Mh(){try{return localStorage}catch{}}Bn.exports=Ua()(he);var{formatters:$h}=Bn.exports;$h.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var We=C((ub,ja)=>{"use strict";function za(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function Uh(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return za(r,t)}catch{t.message=r.message,t.stack=r.stack;let o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(r)),za(new o,t)}}ja.exports=Uh});var Ii=C((E0,Ec)=>{"use strict";var Lm=async r=>{let e=0;for await(let t of r)e++;return e};Ec.exports=Lm});var Vu=C((R8,qu)=>{"use strict";qu.exports=Cy;function Cy(r,e){for(var t=new Array(arguments.length-1),n=0,o=2,i=!0;o<arguments.length;)t[n++]=arguments[o++];return new Promise(function(a,c){t[n]=function(u){if(i)if(i=!1,u)c(u);else{for(var l=new Array(arguments.length-1),p=0;p<l.length;)l[p++]=arguments[p];a.apply(null,l)}};try{r.apply(e||null,t)}catch(f){i&&(i=!1,c(f))}})}});var Qu=C(Hu=>{"use strict";var to=Hu;to.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var dr=new Array(64),Wu=new Array(123);for(Pe=0;Pe<64;)Wu[dr[Pe]=Pe<26?Pe+65:Pe<52?Pe+71:Pe<62?Pe-4:Pe-59|43]=Pe++;var Pe;to.encode=function(e,t,n){for(var o=null,i=[],s=0,a=0,c;t<n;){var f=e[t++];switch(a){case 0:i[s++]=dr[f>>2],c=(f&3)<<4,a=1;break;case 1:i[s++]=dr[c|f>>4],c=(f&15)<<2,a=2;break;case 2:i[s++]=dr[c|f>>6],i[s++]=dr[f&63],a=0;break}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),s=0)}return a&&(i[s++]=dr[c],i[s++]=61,a===1&&(i[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))};var Ku="invalid encoding";to.decode=function(e,t,n){for(var o=n,i=0,s,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&i>1)break;if((c=Wu[c])===void 0)throw Error(Ku);switch(i){case 0:s=c,i=1;break;case 1:t[n++]=s<<2|(c&48)>>4,s=c,i=2;break;case 2:t[n++]=(s&15)<<4|(c&60)>>2,s=c,i=3;break;case 3:t[n++]=(s&3)<<6|c,i=0;break}}if(i===1)throw Error(Ku);return n-o};to.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Ju=C((F8,Gu)=>{"use strict";Gu.exports=ro;function ro(){this._listeners={}}ro.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};ro.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],o=0;o<n.length;)n[o].fn===t?n.splice(o,1):++o;return this};ro.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],o=1;o<arguments.length;)n.push(arguments[o++]);for(o=0;o<t.length;)t[o].fn.apply(t[o++].ctx,n)}return this}});var nf=C((M8,rf)=>{"use strict";rf.exports=Yu(Yu);function Yu(r){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function o(c,f,u){e[0]=c,f[u]=t[0],f[u+1]=t[1],f[u+2]=t[2],f[u+3]=t[3]}function i(c,f,u){e[0]=c,f[u]=t[3],f[u+1]=t[2],f[u+2]=t[1],f[u+3]=t[0]}r.writeFloatLE=n?o:i,r.writeFloatBE=n?i:o;function s(c,f){return t[0]=c[f],t[1]=c[f+1],t[2]=c[f+2],t[3]=c[f+3],e[0]}function a(c,f){return t[3]=c[f],t[2]=c[f+1],t[1]=c[f+2],t[0]=c[f+3],e[0]}r.readFloatLE=n?s:a,r.readFloatBE=n?a:s}():function(){function e(n,o,i,s){var a=o<0?1:0;if(a&&(o=-o),o===0)n(1/o>0?0:2147483648,i,s);else if(isNaN(o))n(2143289344,i,s);else if(o>34028234663852886e22)n((a<<31|2139095040)>>>0,i,s);else if(o<11754943508222875e-54)n((a<<31|Math.round(o/1401298464324817e-60))>>>0,i,s);else{var c=Math.floor(Math.log(o)/Math.LN2),f=Math.round(o*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|f)>>>0,i,s)}}r.writeFloatLE=e.bind(null,Xu),r.writeFloatBE=e.bind(null,Zu);function t(n,o,i){var s=n(o,i),a=(s>>31)*2+1,c=s>>>23&255,f=s&8388607;return c===255?f?NaN:a*(1/0):c===0?a*1401298464324817e-60*f:a*Math.pow(2,c-150)*(f+8388608)}r.readFloatLE=t.bind(null,ef),r.readFloatBE=t.bind(null,tf)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function o(c,f,u){e[0]=c,f[u]=t[0],f[u+1]=t[1],f[u+2]=t[2],f[u+3]=t[3],f[u+4]=t[4],f[u+5]=t[5],f[u+6]=t[6],f[u+7]=t[7]}function i(c,f,u){e[0]=c,f[u]=t[7],f[u+1]=t[6],f[u+2]=t[5],f[u+3]=t[4],f[u+4]=t[3],f[u+5]=t[2],f[u+6]=t[1],f[u+7]=t[0]}r.writeDoubleLE=n?o:i,r.writeDoubleBE=n?i:o;function s(c,f){return t[0]=c[f],t[1]=c[f+1],t[2]=c[f+2],t[3]=c[f+3],t[4]=c[f+4],t[5]=c[f+5],t[6]=c[f+6],t[7]=c[f+7],e[0]}function a(c,f){return t[7]=c[f],t[6]=c[f+1],t[5]=c[f+2],t[4]=c[f+3],t[3]=c[f+4],t[2]=c[f+5],t[1]=c[f+6],t[0]=c[f+7],e[0]}r.readDoubleLE=n?s:a,r.readDoubleBE=n?a:s}():function(){function e(n,o,i,s,a,c){var f=s<0?1:0;if(f&&(s=-s),s===0)n(0,a,c+o),n(1/s>0?0:2147483648,a,c+i);else if(isNaN(s))n(0,a,c+o),n(2146959360,a,c+i);else if(s>17976931348623157e292)n(0,a,c+o),n((f<<31|2146435072)>>>0,a,c+i);else{var u;if(s<22250738585072014e-324)u=s/5e-324,n(u>>>0,a,c+o),n((f<<31|u/4294967296)>>>0,a,c+i);else{var l=Math.floor(Math.log(s)/Math.LN2);l===1024&&(l=1023),u=s*Math.pow(2,-l),n(u*4503599627370496>>>0,a,c+o),n((f<<31|l+1023<<20|u*1048576&1048575)>>>0,a,c+i)}}}r.writeDoubleLE=e.bind(null,Xu,0,4),r.writeDoubleBE=e.bind(null,Zu,4,0);function t(n,o,i,s,a){var c=n(s,a+o),f=n(s,a+i),u=(f>>31)*2+1,l=f>>>20&2047,p=4294967296*(f&1048575)+c;return l===2047?p?NaN:u*(1/0):l===0?u*5e-324*p:u*Math.pow(2,l-1075)*(p+4503599627370496)}r.readDoubleLE=t.bind(null,ef,0,4),r.readDoubleBE=t.bind(null,tf,4,0)}(),r}function Xu(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Zu(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function ef(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function tf(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var of=C((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var af=C(sf=>{"use strict";var $i=sf;$i.length=function(e){for(var t=0,n=0,o=0;o<e.length;++o)n=e.charCodeAt(o),n<128?t+=1:n<2048?t+=2:(n&64512)===55296&&(e.charCodeAt(o+1)&64512)===56320?(++o,t+=4):t+=3;return t};$i.read=function(e,t,n){var o=n-t;if(o<1)return"";for(var i=null,s=[],a=0,c;t<n;)c=e[t++],c<128?s[a++]=c:c>191&&c<224?s[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[a++]=55296+(c>>10),s[a++]=56320+(c&1023)):s[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};$i.write=function(e,t,n){for(var o=n,i,s,a=0;a<e.length;++a)i=e.charCodeAt(a),i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)===55296&&((s=e.charCodeAt(a+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++a,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128);return n-o}});var uf=C((U8,cf)=>{"use strict";cf.exports=Sy;function Sy(r,e,t){var n=t||8192,o=n>>>1,i=null,s=n;return function(c){if(c<1||c>o)return r(c);s+c>n&&(i=r(n),s=0);var f=e.call(i,s,s+=c);return s&7&&(s=(s|7)+1),f}}});var lf=C((z8,ff)=>{"use strict";ff.exports=re;var Qr=ct();function re(r,e){this.lo=r>>>0,this.hi=e>>>0}var Ot=re.zero=new re(0,0);Ot.toNumber=function(){return 0};Ot.zzEncode=Ot.zzDecode=function(){return this};Ot.length=function(){return 1};var Ty=re.zeroHash="\0\0\0\0\0\0\0\0";re.fromNumber=function(e){if(e===0)return Ot;var t=e<0;t&&(e=-e);var n=e>>>0,o=(e-n)/4294967296>>>0;return t&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new re(n,o)};re.from=function(e){if(typeof e=="number")return re.fromNumber(e);if(Qr.isString(e))if(Qr.Long)e=Qr.Long.fromString(e);else return re.fromNumber(parseInt(e,10));return e.low||e.high?new re(e.low>>>0,e.high>>>0):Ot};re.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};re.prototype.toLong=function(e){return Qr.Long?new Qr.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var at=String.prototype.charCodeAt;re.fromHash=function(e){return e===Ty?Ot:new re((at.call(e,0)|at.call(e,1)<<8|at.call(e,2)<<16|at.call(e,3)<<24)>>>0,(at.call(e,4)|at.call(e,5)<<8|at.call(e,6)<<16|at.call(e,7)<<24)>>>0)};re.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};re.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};re.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};re.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var ct=C(Ui=>{"use strict";var E=Ui;E.asPromise=Vu();E.base64=Qu();E.EventEmitter=Ju();E.float=nf();E.inquire=of();E.utf8=af();E.pool=uf();E.LongBits=lf();E.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);E.global=E.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||Ui;E.emptyArray=Object.freeze?Object.freeze([]):[];E.emptyObject=Object.freeze?Object.freeze({}):{};E.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};E.isString=function(e){return typeof e=="string"||e instanceof String};E.isObject=function(e){return e&&typeof e=="object"};E.isset=E.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};E.Buffer=function(){try{var r=E.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();E._Buffer_from=null;E._Buffer_allocUnsafe=null;E.newBuffer=function(e){return typeof e=="number"?E.Buffer?E._Buffer_allocUnsafe(e):new E.Array(e):E.Buffer?E._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};E.Array=typeof Uint8Array<"u"?Uint8Array:Array;E.Long=E.global.dcodeIO&&E.global.dcodeIO.Long||E.global.Long||E.inquire("long");E.key2Re=/^true|false|0|1$/;E.key32Re=/^-?(?:0|[1-9][0-9]*)$/;E.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;E.longToHash=function(e){return e?E.LongBits.from(e).toHash():E.LongBits.zeroHash};E.longFromHash=function(e,t){var n=E.LongBits.fromHash(e);return E.Long?E.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function df(r,e,t){for(var n=Object.keys(e),o=0;o<n.length;++o)(r[n[o]]===void 0||!t)&&(r[n[o]]=e[n[o]]);return r}E.merge=df;E.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function hf(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&df(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}E.newError=hf;E.ProtocolError=hf("ProtocolError");E.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var o=Object.keys(this),i=o.length-1;i>-1;--i)if(t[o[i]]===1&&this[o[i]]!==void 0&&this[o[i]]!==null)return o[i]}};E.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};E.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};E._configure=function(){var r=E.Buffer;if(!r){E._Buffer_from=E._Buffer_allocUnsafe=null;return}E._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},E._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var Hi=C((q8,gf)=>{"use strict";gf.exports=O;var Ce=ct(),zi,no=Ce.LongBits,pf=Ce.base64,mf=Ce.utf8;function Gr(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function qi(){}function Iy(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function O(){this.len=0,this.head=new Gr(qi,0,0),this.tail=this.head,this.states=null}var yf=function(){return Ce.Buffer?function(){return(O.create=function(){return new zi})()}:function(){return new O}};O.create=yf();O.alloc=function(e){return new Ce.Array(e)};Ce.Array!==Array&&(O.alloc=Ce.pool(O.alloc,Ce.Array.prototype.subarray));O.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Gr(e,t,n),this.len+=t,this};function Vi(r,e,t){e[t]=r&255}function Oy(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function Ki(r,e){this.len=r,this.next=void 0,this.val=e}Ki.prototype=Object.create(Gr.prototype);Ki.prototype.fn=Oy;O.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Ki((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};O.prototype.int32=function(e){return e<0?this._push(Wi,10,no.fromNumber(e)):this.uint32(e)};O.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Wi(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}O.prototype.uint64=function(e){var t=no.from(e);return this._push(Wi,t.length(),t)};O.prototype.int64=O.prototype.uint64;O.prototype.sint64=function(e){var t=no.from(e).zzEncode();return this._push(Wi,t.length(),t)};O.prototype.bool=function(e){return this._push(Vi,1,e?1:0)};function ji(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}O.prototype.fixed32=function(e){return this._push(ji,4,e>>>0)};O.prototype.sfixed32=O.prototype.fixed32;O.prototype.fixed64=function(e){var t=no.from(e);return this._push(ji,4,t.lo)._push(ji,4,t.hi)};O.prototype.sfixed64=O.prototype.fixed64;O.prototype.float=function(e){return this._push(Ce.float.writeFloatLE,4,e)};O.prototype.double=function(e){return this._push(Ce.float.writeDoubleLE,8,e)};var Py=Ce.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var o=0;o<e.length;++o)t[n+o]=e[o]};O.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Vi,1,0);if(Ce.isString(e)){var n=O.alloc(t=pf.length(e));pf.decode(e,n,0),e=n}return this.uint32(t)._push(Py,t,e)};O.prototype.string=function(e){var t=mf.length(e);return t?this.uint32(t)._push(mf.write,t,e):this._push(Vi,1,0)};O.prototype.fork=function(){return this.states=new Iy(this),this.head=this.tail=new Gr(qi,0,0),this.len=0,this};O.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Gr(qi,0,0),this.len=0),this};O.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};O.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};O._configure=function(r){zi=r,O.create=yf(),zi._configure()}});var vf=C((V8,bf)=>{"use strict";bf.exports=je;var wf=Hi();(je.prototype=Object.create(wf.prototype)).constructor=je;var ut=ct();function je(){wf.call(this)}je._configure=function(){je.alloc=ut._Buffer_allocUnsafe,je.writeBytesBuffer=ut.Buffer&&ut.Buffer.prototype instanceof Uint8Array&&ut.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var o=0;o<e.length;)t[n++]=e[o++]}};je.prototype.bytes=function(e){ut.isString(e)&&(e=ut._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(je.writeBytesBuffer,t,e),this};function ky(r,e,t){r.length<40?ut.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}je.prototype.string=function(e){var t=ut.Buffer.byteLength(e);return this.uint32(t),t&&this._push(ky,t,e),this};je._configure()});var Ji=C((K8,Af)=>{"use strict";Af.exports=G;var qe=ct(),Gi,xf=qe.LongBits,Ny=qe.utf8;function ke(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function G(r){this.buf=r,this.pos=0,this.len=r.length}var Ef=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new G(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new G(e);throw Error("illegal buffer")},_f=function(){return qe.Buffer?function(t){return(G.create=function(o){return qe.Buffer.isBuffer(o)?new Gi(o):Ef(o)})(t)}:Ef};G.create=_f();G.prototype._slice=qe.Array.prototype.subarray||qe.Array.prototype.slice;G.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ke(this,10);return e}}();G.prototype.int32=function(){return this.uint32()|0};G.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Qi(){var r=new xf(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw ke(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw ke(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}G.prototype.bool=function(){return this.uint32()!==0};function oo(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}G.prototype.fixed32=function(){if(this.pos+4>this.len)throw ke(this,4);return oo(this.buf,this.pos+=4)};G.prototype.sfixed32=function(){if(this.pos+4>this.len)throw ke(this,4);return oo(this.buf,this.pos+=4)|0};function Df(){if(this.pos+8>this.len)throw ke(this,8);return new xf(oo(this.buf,this.pos+=4),oo(this.buf,this.pos+=4))}G.prototype.float=function(){if(this.pos+4>this.len)throw ke(this,4);var e=qe.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};G.prototype.double=function(){if(this.pos+8>this.len)throw ke(this,4);var e=qe.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};G.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw ke(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};G.prototype.string=function(){var e=this.bytes();return Ny.read(e,0,e.length)};G.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ke(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ke(this);while(this.buf[this.pos++]&128);return this};G.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};G._configure=function(r){Gi=r,G.create=_f(),Gi._configure();var e=qe.Long?"toLong":"toNumber";qe.merge(G.prototype,{int64:function(){return Qi.call(this)[e](!1)},uint64:function(){return Qi.call(this)[e](!0)},sint64:function(){return Qi.call(this).zzDecode()[e](!1)},fixed64:function(){return Df.call(this)[e](!0)},sfixed64:function(){return Df.call(this)[e](!1)}})}});var If=C((W8,Tf)=>{"use strict";Tf.exports=Pt;var Sf=Ji();(Pt.prototype=Object.create(Sf.prototype)).constructor=Pt;var Cf=ct();function Pt(r){Sf.call(this,r)}Pt._configure=function(){Cf.Buffer&&(Pt.prototype._slice=Cf.Buffer.prototype.slice)};Pt.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Pt._configure()});var Pf=C((H8,Of)=>{"use strict";Of.exports=Jr;var Yi=ct();(Jr.prototype=Object.create(Yi.EventEmitter.prototype)).constructor=Jr;function Jr(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");Yi.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}Jr.prototype.rpcCall=function r(e,t,n,o,i){if(!o)throw TypeError("request must be specified");var s=this;if(!i)return Yi.asPromise(r,s,e,t,n,o);if(!s.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return s.rpcImpl(e,t[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(c,f){if(c)return s.emit("error",c,e),i(c);if(f===null){s.end(!0);return}if(!(f instanceof n))try{f=n[s.responseDelimited?"decodeDelimited":"decode"](f)}catch(u){return s.emit("error",u,e),i(u)}return s.emit("data",f,e),i(null,f)})}catch(a){s.emit("error",a,e),setTimeout(function(){i(a)},0);return}};Jr.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Nf=C(kf=>{"use strict";var By=kf;By.Service=Pf()});var Rf=C((G8,Bf)=>{"use strict";Bf.exports={}});var Mf=C(Ff=>{"use strict";var fe=Ff;fe.build="minimal";fe.Writer=Hi();fe.BufferWriter=vf();fe.Reader=Ji();fe.BufferReader=If();fe.util=ct();fe.rpc=Nf();fe.roots=Rf();fe.configure=Lf;function Lf(){fe.util._configure(),fe.Writer._configure(fe.BufferWriter),fe.Reader._configure(fe.BufferReader)}Lf()});var ft=C((Y8,$f)=>{"use strict";$f.exports=Mf()});var qf=C((Xi,jf)=>{"use strict";Object.defineProperty(Xi,"__esModule",{value:!0});so.BASE=2166136261;function so(r,e=so.BASE){let t=r.length;for(let n=0;n<t;n++)e^=r.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}Xi.default=so;jf.exports=so});var Wf=C((e1,Kf)=>{Kf.exports=Zi;var Vf=128,Ly=127,Fy=~Ly,My=Math.pow(2,31);function Zi(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw Zi.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=My;)e[t++]=r&255|Vf,r/=128;for(;r&Fy;)e[t++]=r&255|Vf,r>>>=7;return e[t]=r|0,Zi.bytes=t-n+1,e}});var Gf=C((t1,Qf)=>{Qf.exports=es;var $y=128,Hf=127;function es(r,n){var t=0,n=n||0,o=0,i=n,s,a=r.length;do{if(i>=a||o>49)throw es.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=o<28?(s&Hf)<<o:(s&Hf)*Math.pow(2,o),o+=7}while(s>=$y);return es.bytes=i-n,t}});var Yf=C((r1,Jf)=>{var Uy=Math.pow(2,7),zy=Math.pow(2,14),jy=Math.pow(2,21),qy=Math.pow(2,28),Vy=Math.pow(2,35),Ky=Math.pow(2,42),Wy=Math.pow(2,49),Hy=Math.pow(2,56),Qy=Math.pow(2,63);Jf.exports=function(r){return r<Uy?1:r<zy?2:r<jy?3:r<qy?4:r<Vy?5:r<Ky?6:r<Wy?7:r<Hy?8:r<Qy?9:10}});var Yr=C((n1,Xf)=>{Xf.exports={encode:Wf(),decode:Gf(),encodingLength:Yf()}});var Zl=C((TE,Co)=>{"use strict";Co.exports=yw;Co.exports.format=Yl;Co.exports.parse=Xl;var hw=/\B(?=(\d{3})+(?!\d))/g,pw=/(?:\.0*|(\.[^0]+)0+)$/,mt={b:1,kb:1<<10,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},mw=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function yw(r,e){return typeof r=="string"?Xl(r):typeof r=="number"?Yl(r,e):null}function Yl(r,e){if(!Number.isFinite(r))return null;var t=Math.abs(r),n=e&&e.thousandsSeparator||"",o=e&&e.unitSeparator||"",i=e&&e.decimalPlaces!==void 0?e.decimalPlaces:2,s=Boolean(e&&e.fixedDecimals),a=e&&e.unit||"";(!a||!mt[a.toLowerCase()])&&(t>=mt.pb?a="PB":t>=mt.tb?a="TB":t>=mt.gb?a="GB":t>=mt.mb?a="MB":t>=mt.kb?a="KB":a="B");var c=r/mt[a.toLowerCase()],f=c.toFixed(i);return s||(f=f.replace(pw,"$1")),n&&(f=f.split(".").map(function(u,l){return l===0?u.replace(hw,n):u}).join(".")),f+o+a}function Xl(r){if(typeof r=="number"&&!isNaN(r))return r;if(typeof r!="string")return null;var e=mw.exec(r),t,n="b";return e?(t=parseFloat(e[1]),n=e[4].toLowerCase()):(t=parseInt(r,10),n="b"),isNaN(t)?null:Math.floor(mt[n]*t)}});var td=C((IE,ed)=>{"use strict";ed.exports=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;let e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}});var ad=C((id,sd)=>{"use strict";var So=td(),{hasOwnProperty:nd}=Object.prototype,{propertyIsEnumerable:gw}=Object,_r=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),ww=id,rd={concatArrays:!1,ignoreUndefined:!1},To=r=>{let e=[];for(let t in r)nd.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){let t=Object.getOwnPropertySymbols(r);for(let n of t)gw.call(r,n)&&e.push(n)}return e};function Ar(r){return Array.isArray(r)?bw(r):So(r)?vw(r):r}function bw(r){let e=r.slice(0,0);return To(r).forEach(t=>{_r(e,t,Ar(r[t]))}),e}function vw(r){let e=Object.getPrototypeOf(r)===null?Object.create(null):{};return To(r).forEach(t=>{_r(e,t,Ar(r[t]))}),e}var od=(r,e,t,n)=>(t.forEach(o=>{typeof e[o]>"u"&&n.ignoreUndefined||(o in r&&r[o]!==Object.getPrototypeOf(r)?_r(r,o,Ws(r[o],e[o],n)):_r(r,o,Ar(e[o])))}),r),Ew=(r,e,t)=>{let n=r.slice(0,0),o=0;return[r,e].forEach(i=>{let s=[];for(let a=0;a<i.length;a++)!nd.call(i,a)||(s.push(String(a)),i===r?_r(n,o++,i[a]):_r(n,o++,Ar(i[a])));n=od(n,i,To(i).filter(a=>!s.includes(a)),t)}),n};function Ws(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?Ew(r,e,t):!So(e)||!So(r)?Ar(e):od(r,e,To(e),t)}sd.exports=function(...r){let e=Ws(Ar(rd),this!==ww&&this||{},rd),t={_:{}};for(let n of r)if(n!==void 0){if(!So(n))throw new TypeError("`"+n+"` is not an Option Object");t=Ws(t,{_:n},e)}return t._}});var Gs=C((ME,Qs)=>{"use strict";var Aw=Object.prototype.hasOwnProperty,ce="~";function fn(){}Object.create&&(fn.prototype=Object.create(null),new fn().__proto__||(ce=!1));function Cw(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function md(r,e,t,n,o){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Cw(t,n||r,o),s=ce?ce+e:e;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],i]:r._events[s].push(i):(r._events[s]=i,r._eventsCount++),r}function Po(r,e){--r._eventsCount===0?r._events=new fn:delete r._events[e]}function ie(){this._events=new fn,this._eventsCount=0}ie.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)Aw.call(t,n)&&e.push(ce?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};ie.prototype.listeners=function(e){var t=ce?ce+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s};ie.prototype.listenerCount=function(e){var t=ce?ce+e:e,n=this._events[t];return n?n.fn?1:n.length:0};ie.prototype.emit=function(e,t,n,o,i,s){var a=ce?ce+e:e;if(!this._events[a])return!1;var c=this._events[a],f=arguments.length,u,l;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,i),!0;case 6:return c.fn.call(c.context,t,n,o,i,s),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p=c.length,g;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,o);break;default:if(!u)for(g=1,u=new Array(f-1);g<f;g++)u[g-1]=arguments[g];c[l].fn.apply(c[l].context,u)}}return!0};ie.prototype.on=function(e,t,n){return md(this,e,t,n,!1)};ie.prototype.once=function(e,t,n){return md(this,e,t,n,!0)};ie.prototype.removeListener=function(e,t,n,o){var i=ce?ce+e:e;if(!this._events[i])return this;if(!t)return Po(this,i),this;var s=this._events[i];if(s.fn)s.fn===t&&(!o||s.once)&&(!n||s.context===n)&&Po(this,i);else{for(var a=0,c=[],f=s.length;a<f;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[i]=c.length===1?c[0]:c:Po(this,i)}return this};ie.prototype.removeAllListeners=function(e){var t;return e?(t=ce?ce+e:e,this._events[t]&&Po(this,t)):(this._events=new fn,this._eventsCount=0),this};ie.prototype.off=ie.prototype.removeListener;ie.prototype.addListener=ie.prototype.on;ie.prefixed=ce;ie.EventEmitter=ie;typeof Qs<"u"&&(Qs.exports=ie)});var ih=C((j2,oh)=>{oh.exports=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}});var ch=C((V2,ah)=>{var sh=ih();ah.exports=class{constructor(e){this.hwm=e||16,this.head=new sh(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){let t=this.head;this.head=t.next=new sh(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next){let t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}});var fh=C((K2,uh)=>{var ka=ch();uh.exports=r=>{r=r||{};let e;typeof r=="function"?(e=r,r={}):e=r.onEnd;let t=new ka,n,o,i,s=()=>{if(!t.isEmpty()){if(r.writev){let m,_=[];for(;!t.isEmpty();){if(m=t.shift(),m.error)throw m.error;_.push(m.value)}return{done:m.done,value:_}}let h=t.shift();if(h.error)throw h.error;return h}return i?{done:!0}:new Promise((h,m)=>{o=_=>(o=null,_.error?m(_.error):r.writev&&!_.done?h({done:_.done,value:[_.value]}):h(_),n)})},a=h=>o?o(h):(t.push(h),n),c=h=>(t=new ka,o?o({error:h}):(t.push({error:h}),n)),f=h=>i?n:a({done:!1,value:h}),u=h=>i?n:(i=!0,h?c(h):a({done:!0})),l=()=>(t=new ka,u(),{done:!0}),p=h=>(u(h),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:s,return:l,throw:p,push:f,end:u},!e)return n;let g=n;return n={[Symbol.asyncIterator](){return this},next(){return g.next()},throw(h){return g.throw(h),e&&(e(h),e=null),{done:!0}},return(){return g.return(),e&&(e(),e=null),{done:!0}},push:f,end(h){return g.end(h),e&&(e(h),e=null),n}},n}});var dh=C((W2,lh)=>{"use strict";var Vw=fh(),Kw=async function*(...r){let e=Vw();setTimeout(async()=>{try{await Promise.all(r.map(async t=>{for await(let n of t)e.push(n)})),e.end()}catch(t){e.end(t)}},0),yield*e};lh.exports=Kw});var ob={};R(ob,{createRepo:()=>tb});var Pr=Sh;function Sh(r,e,t){if(!r)return t;var n,o;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;)if(o=n.shift(),!r||(r=r[o],r===void 0))return t;return r}var bh=S(Me(),1),Vt=S(We(),1);var zh=Ka,qa=128,jh=127,qh=~jh,Vh=Math.pow(2,31);function Ka(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Vh;)e[t++]=r&255|qa,r/=128;for(;r&qh;)e[t++]=r&255|qa,r>>>=7;return e[t]=r|0,Ka.bytes=t-n+1,e}var Kh=Zo,Wh=128,Va=127;function Zo(r,n){var t=0,n=n||0,o=0,i=n,s,a=r.length;do{if(i>=a)throw Zo.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=o<28?(s&Va)<<o:(s&Va)*Math.pow(2,o),o+=7}while(s>=Wh);return Zo.bytes=i-n,t}var Hh=Math.pow(2,7),Qh=Math.pow(2,14),Gh=Math.pow(2,21),Jh=Math.pow(2,28),Yh=Math.pow(2,35),Xh=Math.pow(2,42),Zh=Math.pow(2,49),ep=Math.pow(2,56),tp=Math.pow(2,63),rp=function(r){return r<Hh?1:r<Qh?2:r<Gh?3:r<Jh?4:r<Yh?5:r<Xh?6:r<Zh?7:r<ep?8:r<tp?9:10},np={encode:zh,decode:Kh,encodingLength:rp},op=np,kr=op;var Nr=(r,e=0)=>[kr.decode(r,e),kr.decode.bytes],Qt=(r,e,t=0)=>(kr.encode(r,e,t),e),Gt=r=>kr.encodingLength(r);var db=new Uint8Array(0);var Wa=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},He=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var Ha=r=>new TextEncoder().encode(r),Qa=r=>new TextDecoder().decode(r);var _t=(r,e)=>{let t=e.byteLength,n=Gt(r),o=n+Gt(t),i=new Uint8Array(o+t);return Qt(r,i,0),Qt(t,i,n),i.set(e,o),new Jt(r,t,e,i)},Yt=r=>{let e=He(r),[t,n]=Nr(e),[o,i]=Nr(e.subarray(n)),s=e.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new Jt(t,o,s,e)},Ja=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&Wa(r.bytes,e.bytes),Jt=class{constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}};var oi={};R(oi,{base58btc:()=>$e,base58flickr:()=>fp});function ip(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var i=r.charAt(o),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=o}var a=r.length,c=r.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";for(var m=0,_=0,T=0,B=h.length;T!==B&&h[T]===0;)T++,m++;for(var $=(B-T)*u+1>>>0,k=new Uint8Array($);T!==B;){for(var q=h[T],Q=0,L=$-1;(q!==0||Q<_)&&L!==-1;L--,Q++)q+=256*k[L]>>>0,k[L]=q%a>>>0,q=q/a>>>0;if(q!==0)throw new Error("Non-zero carry");_=Q,T++}for(var V=$-_;V!==$&&k[V]===0;)V++;for(var Te=c.repeat(m);V<$;++V)Te+=r.charAt(k[V]);return Te}function p(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;var m=0;if(h[m]!==" "){for(var _=0,T=0;h[m]===c;)_++,m++;for(var B=(h.length-m)*f+1>>>0,$=new Uint8Array(B);h[m];){var k=t[h.charCodeAt(m)];if(k===255)return;for(var q=0,Q=B-1;(k!==0||q<T)&&Q!==-1;Q--,q++)k+=a*$[Q]>>>0,$[Q]=k%256>>>0,k=k/256>>>0;if(k!==0)throw new Error("Non-zero carry");T=q,m++}if(h[m]!==" "){for(var L=B-T;L!==B&&$[L]===0;)L++;for(var V=new Uint8Array(_+(B-L)),Te=_;L!==B;)V[Te++]=$[L++];return V}}}function g(h){var m=p(h);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:p,decode:g}}var sp=ip,ap=sp,Ya=ap;var ei=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ti=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Xa(this,e)}},ri=class{constructor(e){this.decoders=e}or(e){return Xa(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Xa=(r,e)=>new ri({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),ni=class{constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new ei(e,t,n),this.decoder=new ti(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Xt=({name:r,prefix:e,encode:t,decode:n})=>new ni(r,e,t,n),nt=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:o}=Ya(t,e);return Xt({prefix:r,name:e,encode:n,decode:i=>He(o(i))})},cp=(r,e,t,n)=>{let o={};for(let u=0;u<e.length;++u)o[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let s=new Uint8Array(i*t/8|0),a=0,c=0,f=0;for(let u=0;u<i;++u){let l=o[r[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,s[f++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},up=(r,e,t)=>{let n=e[e.length-1]==="=",o=(1<<t)-1,i="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,i+=e[o&a>>s];if(s&&(i+=e[o&a<<t-s]),n)for(;i.length*t&7;)i+="=";return i},K=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Xt({prefix:e,name:r,encode(o){return up(o,n,t)},decode(o){return cp(o,n,t,r)}});var $e=nt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fp=nt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ii={};R(ii,{base32:()=>se,base32hex:()=>pp,base32hexpad:()=>yp,base32hexpadupper:()=>gp,base32hexupper:()=>mp,base32pad:()=>dp,base32padupper:()=>hp,base32upper:()=>lp,base32z:()=>wp});var se=K({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lp=K({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dp=K({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),hp=K({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pp=K({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),mp=K({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yp=K({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gp=K({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),wp=K({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var I=class{constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this.byteOffset=o.byteOffset,this.byteLength=o.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:Fn,byteLength:Fn,code:Ln,version:Ln,multihash:Ln,bytes:Ln,_baseCache:Fn,asCID:Fn})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==Br)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Dp)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return I.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=_t(e,t);return I.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Ja(this.multihash,e.multihash)}toString(e){let{bytes:t,version:n,_baseCache:o}=this;switch(n){case 0:return vp(t,o,e||$e.encoder);default:return Ep(t,o,e||se.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return _p(/^0\.0/,Ap),!!(e&&(e[ec]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof I)return e;if(e!=null&&e.asCID===e){let{version:t,code:n,multihash:o,bytes:i}=e;return new I(t,n,o,i||Za(t,n,o.bytes))}else if(e!=null&&e[ec]===!0){let{version:t,multihash:n,code:o}=e,i=Yt(n);return I.create(t,o,i)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==Br)throw new Error(`Version 0 CID must use dag-pb (code: ${Br}) block encoding`);return new I(e,t,n,n.bytes)}case 1:{let o=Za(e,t,n.bytes);return new I(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return I.create(0,Br,e)}static createV1(e,t){return I.create(1,e,t)}static decode(e){let[t,n]=I.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=I.inspectBytes(e),n=t.size-t.multihashSize,o=He(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=o.subarray(t.multihashSize-t.digestSize),s=new Jt(t.multihashCode,t.digestSize,i,o);return[t.version===0?I.createV0(s):I.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[l,p]=Nr(e.subarray(t));return t+=p,l},o=n(),i=Br;if(o===18?(o=0,t=0):o===1&&(i=n()),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=t,a=n(),c=n(),f=t+c,u=f-s;return{version:o,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:f}}static parse(e,t){let[n,o]=bp(e,t),i=I.decode(o);return i._baseCache.set(n,e),i}},bp=(r,e)=>{switch(r[0]){case"Q":{let t=e||$e;return[$e.prefix,t.decode(`${$e.prefix}${r}`)]}case $e.prefix:{let t=e||$e;return[$e.prefix,t.decode(r)]}case se.prefix:{let t=e||se;return[se.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},vp=(r,e,t)=>{let{prefix:n}=t;if(n!==$e.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(n);if(o==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return o},Ep=(r,e,t)=>{let{prefix:n}=t,o=e.get(n);if(o==null){let i=t.encode(r);return e.set(n,i),i}else return o},Br=112,Dp=18,Za=(r,e,t)=>{let n=Gt(r),o=n+Gt(e),i=new Uint8Array(o+t.byteLength);return Qt(r,i,0),Qt(e,i,n),i.set(t,o),i},ec=Symbol.for("@ipld/js-cid/CID"),Ln={writable:!1,configurable:!1,enumerable:!0},Fn={writable:!1,enumerable:!1,configurable:!1},xp="0.0.0-dev",_p=(r,e)=>{if(r.test(xp))console.warn(e);else throw new Error(e)},Ap=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var Mn=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");var li={};R(li,{identity:()=>Pp});function Cp(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var i=r.charAt(o),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=o}var a=r.length,c=r.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";for(var m=0,_=0,T=0,B=h.length;T!==B&&h[T]===0;)T++,m++;for(var $=(B-T)*u+1>>>0,k=new Uint8Array($);T!==B;){for(var q=h[T],Q=0,L=$-1;(q!==0||Q<_)&&L!==-1;L--,Q++)q+=256*k[L]>>>0,k[L]=q%a>>>0,q=q/a>>>0;if(q!==0)throw new Error("Non-zero carry");_=Q,T++}for(var V=$-_;V!==$&&k[V]===0;)V++;for(var Te=c.repeat(m);V<$;++V)Te+=r.charAt(k[V]);return Te}function p(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;var m=0;if(h[m]!==" "){for(var _=0,T=0;h[m]===c;)_++,m++;for(var B=(h.length-m)*f+1>>>0,$=new Uint8Array(B);h[m];){var k=t[h.charCodeAt(m)];if(k===255)return;for(var q=0,Q=B-1;(k!==0||q<T)&&Q!==-1;Q--,q++)k+=a*$[Q]>>>0,$[Q]=k%256>>>0,k=k/256>>>0;if(k!==0)throw new Error("Non-zero carry");T=q,m++}if(h[m]!==" "){for(var L=B-T;L!==B&&$[L]===0;)L++;for(var V=new Uint8Array(_+(B-L)),Te=_;L!==B;)V[Te++]=$[L++];return V}}}function g(h){var m=p(h);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:p,decode:g}}var Sp=Cp,Tp=Sp,tc=Tp;var Cb=new Uint8Array(0);var rc=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Qe=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var nc=r=>new TextEncoder().encode(r),oc=r=>new TextDecoder().decode(r);var ai=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ci=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ic(this,e)}},ui=class{constructor(e){this.decoders=e}or(e){return ic(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},ic=(r,e)=>new ui({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),fi=class{constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new ai(e,t,n),this.decoder=new ci(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Zt=({name:r,prefix:e,encode:t,decode:n})=>new fi(r,e,t,n),ot=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:o}=tc(t,e);return Zt({prefix:r,name:e,encode:n,decode:i=>Qe(o(i))})},Ip=(r,e,t,n)=>{let o={};for(let u=0;u<e.length;++u)o[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let s=new Uint8Array(i*t/8|0),a=0,c=0,f=0;for(let u=0;u<i;++u){let l=o[r[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,s[f++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},Op=(r,e,t)=>{let n=e[e.length-1]==="=",o=(1<<t)-1,i="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,i+=e[o&a>>s];if(s&&(i+=e[o&a<<t-s]),n)for(;i.length*t&7;)i+="=";return i},W=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Zt({prefix:e,name:r,encode(o){return Op(o,n,t)},decode(o){return Ip(o,n,t,r)}});var Pp=Zt({prefix:"\0",name:"identity",encode:r=>oc(r),decode:r=>nc(r)});var di={};R(di,{base2:()=>kp});var kp=W({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var hi={};R(hi,{base8:()=>Np});var Np=W({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var pi={};R(pi,{base10:()=>Bp});var Bp=ot({prefix:"9",name:"base10",alphabet:"0123456789"});var mi={};R(mi,{base16:()=>Rp,base16upper:()=>Lp});var Rp=W({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Lp=W({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var yi={};R(yi,{base32:()=>ae,base32hex:()=>Up,base32hexpad:()=>jp,base32hexpadupper:()=>qp,base32hexupper:()=>zp,base32pad:()=>Mp,base32padupper:()=>$p,base32upper:()=>Fp,base32z:()=>Vp});var ae=W({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Fp=W({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Mp=W({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$p=W({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Up=W({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zp=W({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),jp=W({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),qp=W({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Vp=W({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var gi={};R(gi,{base36:()=>Kp,base36upper:()=>Wp});var Kp=ot({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Wp=ot({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var wi={};R(wi,{base58btc:()=>ue,base58flickr:()=>Hp});var ue=ot({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Hp=ot({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var bi={};R(bi,{base64:()=>Qp,base64pad:()=>Gp,base64url:()=>Jp,base64urlpad:()=>Yp});var Qp=W({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Gp=W({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jp=W({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yp=W({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var vi={};R(vi,{base256emoji:()=>rm});var sc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Xp=sc.reduce((r,e,t)=>(r[t]=e,r),[]),Zp=sc.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function em(r){return r.reduce((e,t)=>(e+=Xp[t],e),"")}function tm(r){let e=[];for(let t of r){let n=Zp[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var rm=Zt({prefix:"\u{1F680}",name:"base256emoji",encode:em,decode:tm});var _i={};R(_i,{sha256:()=>Em,sha512:()=>Dm});var nm=uc,ac=128,om=127,im=~om,sm=Math.pow(2,31);function uc(r,e,t){e=e||[],t=t||0;for(var n=t;r>=sm;)e[t++]=r&255|ac,r/=128;for(;r&im;)e[t++]=r&255|ac,r>>>=7;return e[t]=r|0,uc.bytes=t-n+1,e}var am=Ei,cm=128,cc=127;function Ei(r,n){var t=0,n=n||0,o=0,i=n,s,a=r.length;do{if(i>=a)throw Ei.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=o<28?(s&cc)<<o:(s&cc)*Math.pow(2,o),o+=7}while(s>=cm);return Ei.bytes=i-n,t}var um=Math.pow(2,7),fm=Math.pow(2,14),lm=Math.pow(2,21),dm=Math.pow(2,28),hm=Math.pow(2,35),pm=Math.pow(2,42),mm=Math.pow(2,49),ym=Math.pow(2,56),gm=Math.pow(2,63),wm=function(r){return r<um?1:r<fm?2:r<lm?3:r<dm?4:r<hm?5:r<pm?6:r<mm?7:r<ym?8:r<gm?9:10},bm={encode:nm,decode:am,encodingLength:wm},vm=bm,Rr=vm;var Lr=(r,e=0)=>[Rr.decode(r,e),Rr.decode.bytes],er=(r,e,t=0)=>(Rr.encode(r,e,t),e),tr=r=>Rr.encodingLength(r);var Ct=(r,e)=>{let t=e.byteLength,n=tr(r),o=n+tr(t),i=new Uint8Array(o+t);return er(r,i,0),er(t,i,n),i.set(e,o),new rr(r,t,e,i)},nr=r=>{let e=Qe(r),[t,n]=Lr(e),[o,i]=Lr(e.subarray(n)),s=e.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new rr(t,o,s,e)},fc=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&rc(r.bytes,t.bytes)}},rr=class{constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}};var xi=({name:r,code:e,encode:t})=>new Di(r,e,t),Di=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Ct(this.code,t):t.then(n=>Ct(this.code,n))}else throw Error("Unknown type, must be binary type")}};var dc=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Em=xi({name:"sha2-256",code:18,encode:dc("SHA-256")}),Dm=xi({name:"sha2-512",code:19,encode:dc("SHA-512")});var Ci={};R(Ci,{identity:()=>Ai});var hc=0,xm="identity",pc=Qe,_m=r=>Ct(hc,pc(r)),Ai={code:hc,name:xm,encode:pc,digest:_m};var Hb=new TextEncoder,Qb=new TextDecoder;var Cm=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return Tm(t,Si(r),e||ue.encoder);default:return Im(t,Si(r),e||ae.encoder)}},yc=new WeakMap,Si=r=>{let e=yc.get(r);if(e==null){let t=new Map;return yc.set(r,t),t}return e},A=class{constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Fr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Om)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return A.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Ct(e,t);return A.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return A.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&fc(e.multihash,n.multihash)}toString(e){return Cm(this,e)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof A)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:o,multihash:i,bytes:s}=t;return new A(n,o,i,s||gc(n,o,i.bytes))}else if(t[Pm]===!0){let{version:n,multihash:o,code:i}=t,s=nr(o);return A.create(n,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Fr)throw new Error(`Version 0 CID must use dag-pb (code: ${Fr}) block encoding`);return new A(e,t,n,n.bytes)}case 1:{let o=gc(e,t,n.bytes);return new A(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return A.create(0,Fr,e)}static createV1(e,t){return A.create(1,e,t)}static decode(e){let[t,n]=A.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=A.inspectBytes(e),n=t.size-t.multihashSize,o=Qe(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=o.subarray(t.multihashSize-t.digestSize),s=new rr(t.multihashCode,t.digestSize,i,o);return[t.version===0?A.createV0(s):A.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[l,p]=Lr(e.subarray(t));return t+=p,l},o=n(),i=Fr;if(o===18?(o=0,t=0):i=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=t,a=n(),c=n(),f=t+c,u=f-s;return{version:o,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:f}}static parse(e,t){let[n,o]=Sm(e,t),i=A.decode(o);return Si(i).set(n,e),i}},Sm=(r,e)=>{switch(r[0]){case"Q":{let t=e||ue;return[ue.prefix,t.decode(`${ue.prefix}${r}`)]}case ue.prefix:{let t=e||ue;return[ue.prefix,t.decode(r)]}case ae.prefix:{let t=e||ae;return[ae.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Tm=(r,e,t)=>{let{prefix:n}=t;if(n!==ue.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(n);if(o==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return o},Im=(r,e,t)=>{let{prefix:n}=t,o=e.get(n);if(o==null){let i=t.encode(r);return e.set(n,i),i}else return o},Fr=112,Om=18,gc=(r,e,t)=>{let n=tr(r),o=n+tr(e),i=new Uint8Array(o+t.byteLength);return er(r,i,0),er(e,i,n),i.set(t,o),i},Pm=Symbol.for("@ipld/js-cid/CID");var Mr={...li,...di,...hi,...pi,...mi,...yi,...gi,...wi,...bi,...vi},o0={..._i,...Ci};function or(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Un(r=0){return globalThis.Buffer?.allocUnsafe!=null?or(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function bc(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var wc=bc("utf8","u",r=>{let e=new TextDecoder("utf8");return"u"+e.decode(r)},r=>new TextEncoder().encode(r.substring(1))),Ti=bc("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Un(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),km={utf8:wc,"utf-8":wc,hex:Mr.base16,latin1:Ti,ascii:Ti,binary:Ti,...Mr},zn=km;function U(r,e="utf8"){let t=zn[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function pe(r,e="utf8"){let t=zn[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?or(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var Ge="/",vc=new TextEncoder().encode(Ge),jn=vc[0],D=class{constructor(e,t){if(typeof e=="string")this._buf=pe(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==jn)throw new Error("Invalid key")}toString(e="utf8"){return U(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new D(e.join(Ge))}static random(){return new D(Mn().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new D(e):typeof e.uint8Array=="function"?new D(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=vc),this._buf[0]!==jn){let e=new Uint8Array(this._buf.byteLength+1);e.fill(jn,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===jn;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let o=0;o<t.length;o++){if(n.length<o+1)return!1;let i=t[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return t.length<n.length}reverse(){return D.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Ge).slice(1)}type(){return Nm(this.baseNamespace())}name(){return Bm(this.baseNamespace())}instance(e){return new D(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Ge)||(e+=Ge),e+=this.type(),new D(e)}parent(){let e=this.list();return e.length===1?new D(Ge):new D(e.slice(0,-1).join(Ge))}child(e){return this.toString()===Ge?e:e.toString()===Ge?this:new D(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return D.withNamespaces([...this.namespaces(),...Rm(e.map(t=>t.namespaces()))])}};function Nm(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Bm(r){let e=r.split(":");return e[e.length-1]}function Rm(r){return[].concat(...r)}var Ac=S(Me(),1),Cc=S(Ii(),1);var Dc=85;var Fm=(0,Ac.default)("ipfs:repo:migrator:migration-8");function Sc(r){return r.child?Sc(r.child):r}function Mm(r){try{let e=se.decode(`b${r.toString().toLowerCase().slice(1)}`),t=I.decode(e).multihash.bytes,n=se.encode(t).slice(1).toUpperCase();return new D(`/${n}`,!1)}catch{return r}}function $m(r){try{let e=se.decode(`b${r.toString().toLowerCase().slice(1)}`),t=Yt(e),n=se.encode(I.createV1(Dc,t).bytes).slice(1);return new D(`/${n.toUpperCase()}`,!1)}catch{return r}}async function _c(r,e,t){let n=r.blocks;await n.open();let o=Sc(n),i=await(0,Cc.default)(o.queryKeys({filters:[s=>t(s).toString()!==s.toString()]}));try{let s=0;for await(let a of o.query({})){let c=t(a.key);c.toString()!==a.key.toString()&&(s+=1,Fm(`Migrating Block from ${a.key} to ${c}`,await o.has(a.key)),await o.delete(a.key),await o.put(c,a.value),e(s/i*100,`Migrated Block from ${a.key} to ${c}`))}}finally{await n.close()}}var Tc={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(r,e=()=>{})=>_c(r,e,Mm),revert:(r,e=()=>{})=>_c(r,e,$m)};var Um=new TextDecoder;function Oi(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let o=r[e++];if(t+=n<28?(o&127)<<n:(o&127)*2**n,o<128)break}return[t,e]}function qn(r,e){let t;[t,e]=Oi(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function Ic(r,e){let t;return[t,e]=Oi(r,e),[t&7,t>>3,e]}function zm(r){let e={},t=r.length,n=0;for(;n<t;){let o,i;if([o,i,n]=Ic(r,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=qn(r,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=qn(r,n),e.Name=Um.decode(s)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[e.Tsize,n]=Oi(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function Oc(r){let e=r.length,t=0,n,o=!1,i;for(;t<e;){let a,c;if([a,c,t]=Ic(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,t]=qn(r,t),n&&(o=!0)}else if(c===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let f;[f,t]=qn(r,t),n.push(zm(f))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return i&&(s.Data=i),s.Links=n||[],s}var kc=new TextEncoder,Pc=2**32,jm=2**31;function qm(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=$r(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){let n=kc.encode(r.Name);t-=n.length,e.set(n,t),t=$r(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=$r(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function Nc(r){let e=Km(r),t=new Uint8Array(e),n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=$r(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let o=r.Links.length-1;o>=0;o--){let i=qm(r.Links[o],t.subarray(0,n));n-=i,n=$r(t,n,i)-1,t[n]=18}return t}function Vm(r){let e=0;if(r.Hash){let t=r.Hash.length;e+=1+t+ir(t)}if(typeof r.Name=="string"){let t=kc.encode(r.Name).length;e+=1+t+ir(t)}return typeof r.Tsize=="number"&&(e+=1+ir(r.Tsize)),e}function Km(r){let e=0;if(r.Data){let t=r.Data.length;e+=1+t+ir(t)}if(r.Links)for(let t of r.Links){let n=Vm(t);e+=1+n+ir(n)}return e}function $r(r,e,t){e-=ir(t);let n=e;for(;t>=jm;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function ir(r){return r%2===0&&r++,Math.floor((Wm(r)+6)/7)}function Wm(r){let e=0;return r>=Pc&&(r=Math.floor(r/Pc),e=32),r>=1<<16&&(r>>>=16,e+=16),r>=1<<8&&(r>>>=8,e+=8),e+Hm[r]}var Hm=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var Qm=["Data","Links"],Gm=["Hash","Name","Tsize"],Bc=new TextEncoder;function Jm(r,e){if(r===e)return 0;let t=r.Name?Bc.encode(r.Name):[],n=e.Name?Bc.encode(e.Name):[],o=t.length,i=n.length;for(let s=0,a=Math.min(o,i);s<a;++s)if(t[s]!==n[s]){o=t[s],i=n[s];break}return o<i?-1:i<o?1:0}function Rc(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function Lc(r){if(!r||typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");if(!Rc(r,Qm))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let e=0;e<r.Links.length;e++){let t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!Rc(t,Gm))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!t.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash.asCID!==t.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0&&(typeof t.Tsize!="number"||t.Tsize%1!==0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e>0&&Jm(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}var Vn=112;function Ur(r){Lc(r);let e={};return r.Links&&(e.Links=r.Links.map(t=>{let n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),Nc(e)}function zr(r){let e=Oc(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{let o={};try{o.Hash=I.decode(n.Hash)}catch{}if(!o.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(o.Name=n.Name),n.Tsize!==void 0&&(o.Tsize=n.Tsize),o})),t}var Ym=["string","number","bigint","symbol"],Xm=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Mc(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(Ym.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(Zm(r))return"Buffer";let t=ey(r);return t||"Object"}function Zm(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function ey(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(Xm.includes(e))return e}var d=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};d.uint=new d(0,"uint",!0);d.negint=new d(1,"negint",!0);d.bytes=new d(2,"bytes",!0);d.string=new d(3,"string",!0);d.array=new d(4,"array",!1);d.map=new d(5,"map",!1);d.tag=new d(6,"tag",!1);d.float=new d(7,"float",!0);d.false=new d(7,"false",!0);d.true=new d(7,"true",!0);d.null=new d(7,"null",!0);d.undefined=new d(7,"undefined",!0);d.break=new d(7,"break",!0);var w=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var sr=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",ty=new TextDecoder,ry=new TextEncoder;function Kn(r){return sr&&globalThis.Buffer.isBuffer(r)}function Pi(r){return r instanceof Uint8Array?Kn(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var jc=sr?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):Uc(r,e,t):(r,e,t)=>t-e>64?ty.decode(r.subarray(e,t)):Uc(r,e,t),qc=sr?r=>r.length>64?globalThis.Buffer.from(r):$c(r):r=>r.length>64?ry.encode(r):$c(r),Ue=r=>Uint8Array.from(r),ar=sr?(r,e,t)=>Kn(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),Vc=sr?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),Pi(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let o of r)n+o.length>t.length&&(o=o.subarray(0,t.length-n)),t.set(o,n),n+=o.length;return t},Kc=sr?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function Wc(r,e){if(Kn(r)&&Kn(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function $c(r,e=1/0){let t,n=r.length,o=null,i=[];for(let s=0;s<n;++s){if(t=r.charCodeAt(s),t>55295&&t<57344){if(!o){if(t>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&i.push(239,191,189);continue}o=t;continue}if(t<56320){(e-=3)>-1&&i.push(239,191,189),o=t;continue}t=(o-55296<<10|t-56320)+65536}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,t<128){if((e-=1)<0)break;i.push(t)}else if(t<2048){if((e-=2)<0)break;i.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;i.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return i}function Uc(r,e,t){let n=[];for(;e<t;){let o=r[e],i=null,s=o>239?4:o>223?3:o>191?2:1;if(e+s<=t){let a,c,f,u;switch(s){case 1:o<128&&(i=o);break;case 2:a=r[e+1],(a&192)===128&&(u=(o&31)<<6|a&63,u>127&&(i=u));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(u=(o&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=r[e+1],c=r[e+2],f=r[e+3],(a&192)===128&&(c&192)===128&&(f&192)===128&&(u=(o&15)<<18|(a&63)<<12|(c&63)<<6|f&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=s}return ny(n)}var zc=4096;function ny(r){let e=r.length;if(e<=zc)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=zc));return t}var oy=256,jr=class{constructor(e=oy){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let o=t.length-(this.maxCursor-this.cursor)-1;t.set(e,o)}else{if(t){let o=t.length-(this.maxCursor-this.cursor)-1;o<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,o),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Kc(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=ar(n,0,this.cursor)}else t=Vc(this.chunks,this.cursor);return e&&this.reset(),t}};var x="CBOR decode error:",ki="CBOR encode error:",qr=[];qr[23]=1;qr[24]=2;qr[25]=3;qr[26]=5;qr[27]=9;function Je(r,e,t){if(r.length-e<t)throw new Error(`${x} not enough data for type`)}var te=[24,256,65536,4294967296,BigInt("18446744073709551616")];function me(r,e,t){Je(r,e,1);let n=r[e];if(t.strict===!0&&n<te[0])throw new Error(`${x} integer encoded in more bytes than necessary (strict decode)`);return n}function ye(r,e,t){Je(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<te[1])throw new Error(`${x} integer encoded in more bytes than necessary (strict decode)`);return n}function ge(r,e,t){Je(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<te[2])throw new Error(`${x} integer encoded in more bytes than necessary (strict decode)`);return n}function we(r,e,t){Je(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],o=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(t.strict===!0&&i<te[3])throw new Error(`${x} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${x} integers outside of the safe integer range are not supported`)}function Hc(r,e,t,n){return new w(d.uint,me(r,e+1,n),2)}function Qc(r,e,t,n){return new w(d.uint,ye(r,e+1,n),3)}function Gc(r,e,t,n){return new w(d.uint,ge(r,e+1,n),5)}function Jc(r,e,t,n){return new w(d.uint,we(r,e+1,n),9)}function _e(r,e){return oe(r,0,e.value)}function oe(r,e,t){if(t<te[0]){let n=Number(t);r.push([e|n])}else if(t<te[1]){let n=Number(t);r.push([e|24,n])}else if(t<te[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<te[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<te[4]){let o=[e|27,0,0,0,0,0,0,0],i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=s&255,s=s>>8,o[3]=s&255,s=s>>8,o[2]=s&255,s=s>>8,o[1]=s&255,r.push(o)}else throw new Error(`${x} encountered BigInt larger than allowable range`)}}_e.encodedSize=function(e){return oe.encodedSize(e.value)};oe.encodedSize=function(e){return e<te[0]?1:e<te[1]?2:e<te[2]?3:e<te[3]?5:9};_e.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function Yc(r,e,t,n){return new w(d.negint,-1-me(r,e+1,n),2)}function Xc(r,e,t,n){return new w(d.negint,-1-ye(r,e+1,n),3)}function Zc(r,e,t,n){return new w(d.negint,-1-ge(r,e+1,n),5)}var Ni=BigInt(-1),eu=BigInt(1);function tu(r,e,t,n){let o=we(r,e+1,n);if(typeof o!="bigint"){let i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new w(d.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${x} integers outside of the safe integer range are not supported`);return new w(d.negint,Ni-BigInt(o),9)}function Wn(r,e){let t=e.value,n=typeof t=="bigint"?t*Ni-eu:t*-1-1;oe(r,e.type.majorEncoded,n)}Wn.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*Ni-eu:t*-1-1;return n<te[0]?1:n<te[1]?2:n<te[2]?3:n<te[3]?5:9};Wn.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Vr(r,e,t,n){Je(r,e,t+n);let o=ar(r,e+t,e+t+n);return new w(d.bytes,o,t+n)}function ru(r,e,t,n){return Vr(r,e,1,t)}function nu(r,e,t,n){return Vr(r,e,2,me(r,e+1,n))}function ou(r,e,t,n){return Vr(r,e,3,ye(r,e+1,n))}function iu(r,e,t,n){return Vr(r,e,5,ge(r,e+1,n))}function su(r,e,t,n){let o=we(r,e+1,n);if(typeof o=="bigint")throw new Error(`${x} 64-bit integer bytes lengths not supported`);return Vr(r,e,9,o)}function Hn(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===d.string?qc(r.value):r.value),r.encodedBytes}function cr(r,e){let t=Hn(e);oe(r,e.type.majorEncoded,t.length),r.push(t)}cr.encodedSize=function(e){let t=Hn(e);return oe.encodedSize(t.length)+t.length};cr.compareTokens=function(e,t){return sy(Hn(e),Hn(t))};function sy(r,e){return r.length<e.length?-1:r.length>e.length?1:Wc(r,e)}function Kr(r,e,t,n,o){let i=t+n;Je(r,e,i);let s=new w(d.string,jc(r,e+t,e+i),i);return o.retainStringBytes===!0&&(s.byteValue=ar(r,e+t,e+i)),s}function au(r,e,t,n){return Kr(r,e,1,t,n)}function cu(r,e,t,n){return Kr(r,e,2,me(r,e+1,n),n)}function uu(r,e,t,n){return Kr(r,e,3,ye(r,e+1,n),n)}function fu(r,e,t,n){return Kr(r,e,5,ge(r,e+1,n),n)}function lu(r,e,t,n){let o=we(r,e+1,n);if(typeof o=="bigint")throw new Error(`${x} 64-bit integer string lengths not supported`);return Kr(r,e,9,o,n)}var du=cr;function ur(r,e,t,n){return new w(d.array,n,t)}function hu(r,e,t,n){return ur(r,e,1,t)}function pu(r,e,t,n){return ur(r,e,2,me(r,e+1,n))}function mu(r,e,t,n){return ur(r,e,3,ye(r,e+1,n))}function yu(r,e,t,n){return ur(r,e,5,ge(r,e+1,n))}function gu(r,e,t,n){let o=we(r,e+1,n);if(typeof o=="bigint")throw new Error(`${x} 64-bit integer array lengths not supported`);return ur(r,e,9,o)}function wu(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${x} indefinite length items not allowed`);return ur(r,e,1,1/0)}function Qn(r,e){oe(r,d.array.majorEncoded,e.value)}Qn.compareTokens=_e.compareTokens;Qn.encodedSize=function(e){return oe.encodedSize(e.value)};function fr(r,e,t,n){return new w(d.map,n,t)}function bu(r,e,t,n){return fr(r,e,1,t)}function vu(r,e,t,n){return fr(r,e,2,me(r,e+1,n))}function Eu(r,e,t,n){return fr(r,e,3,ye(r,e+1,n))}function Du(r,e,t,n){return fr(r,e,5,ge(r,e+1,n))}function xu(r,e,t,n){let o=we(r,e+1,n);if(typeof o=="bigint")throw new Error(`${x} 64-bit integer map lengths not supported`);return fr(r,e,9,o)}function _u(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${x} indefinite length items not allowed`);return fr(r,e,1,1/0)}function Gn(r,e){oe(r,d.map.majorEncoded,e.value)}Gn.compareTokens=_e.compareTokens;Gn.encodedSize=function(e){return oe.encodedSize(e.value)};function Au(r,e,t,n){return new w(d.tag,t,1)}function Cu(r,e,t,n){return new w(d.tag,me(r,e+1,n),2)}function Su(r,e,t,n){return new w(d.tag,ye(r,e+1,n),3)}function Tu(r,e,t,n){return new w(d.tag,ge(r,e+1,n),5)}function Iu(r,e,t,n){return new w(d.tag,we(r,e+1,n),9)}function Jn(r,e){oe(r,d.tag.majorEncoded,e.value)}Jn.compareTokens=_e.compareTokens;Jn.encodedSize=function(e){return oe.encodedSize(e.value)};var dy=20,hy=21,py=22,my=23;function Ou(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${x} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new w(d.null,null,1):new w(d.undefined,void 0,1)}function Pu(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${x} indefinite length items not allowed`);return new w(d.break,void 0,1)}function Bi(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${x} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${x} Infinity values are not supported`)}return new w(d.float,r,e)}function ku(r,e,t,n){return Bi(Ri(r,e+1),3,n)}function Nu(r,e,t,n){return Bi(Li(r,e+1),5,n)}function Bu(r,e,t,n){return Bi(Mu(r,e+1),9,n)}function Yn(r,e,t){let n=e.value;if(n===!1)r.push([d.float.majorEncoded|dy]);else if(n===!0)r.push([d.float.majorEncoded|hy]);else if(n===null)r.push([d.float.majorEncoded|py]);else if(n===void 0)r.push([d.float.majorEncoded|my]);else{let o,i=!1;(!t||t.float64!==!0)&&(Lu(n),o=Ri(Ie,1),n===o||Number.isNaN(n)?(Ie[0]=249,r.push(Ie.slice(0,3)),i=!0):(Fu(n),o=Li(Ie,1),n===o&&(Ie[0]=250,r.push(Ie.slice(0,5)),i=!0))),i||(yy(n),o=Mu(Ie,1),Ie[0]=251,r.push(Ie.slice(0,9)))}}Yn.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){Lu(n);let o=Ri(Ie,1);if(n===o||Number.isNaN(n))return 3;if(Fu(n),o=Li(Ie,1),n===o)return 5}return 9};var Ru=new ArrayBuffer(9),Ae=new DataView(Ru,1),Ie=new Uint8Array(Ru,0);function Lu(r){if(r===1/0)Ae.setUint16(0,31744,!1);else if(r===-1/0)Ae.setUint16(0,64512,!1);else if(Number.isNaN(r))Ae.setUint16(0,32256,!1);else{Ae.setFloat32(0,r);let e=Ae.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Ae.setUint16(0,31744,!1);else if(t===0)Ae.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let o=t-127;o<-24?Ae.setUint16(0,0):o<-14?Ae.setUint16(0,(e&2147483648)>>16|1<<24+o,!1):Ae.setUint16(0,(e&2147483648)>>16|o+15<<10|n>>13,!1)}}}function Ri(r,e){if(r.length-e<2)throw new Error(`${x} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,o=t&1023,i;return n===0?i=o*2**-24:n!==31?i=(o+1024)*2**(n-25):i=o===0?1/0:NaN,t&32768?-i:i}function Fu(r){Ae.setFloat32(0,r,!1)}function Li(r,e){if(r.length-e<4)throw new Error(`${x} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function yy(r){Ae.setFloat64(0,r,!1)}function Mu(r,e){if(r.length-e<8)throw new Error(`${x} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}Yn.compareTokens=_e.compareTokens;function P(r,e,t){throw new Error(`${x} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function Xn(r){return()=>{throw new Error(`${x} ${r}`)}}var y=[];for(let r=0;r<=23;r++)y[r]=P;y[24]=Hc;y[25]=Qc;y[26]=Gc;y[27]=Jc;y[28]=P;y[29]=P;y[30]=P;y[31]=P;for(let r=32;r<=55;r++)y[r]=P;y[56]=Yc;y[57]=Xc;y[58]=Zc;y[59]=tu;y[60]=P;y[61]=P;y[62]=P;y[63]=P;for(let r=64;r<=87;r++)y[r]=ru;y[88]=nu;y[89]=ou;y[90]=iu;y[91]=su;y[92]=P;y[93]=P;y[94]=P;y[95]=Xn("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)y[r]=au;y[120]=cu;y[121]=uu;y[122]=fu;y[123]=lu;y[124]=P;y[125]=P;y[126]=P;y[127]=Xn("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)y[r]=hu;y[152]=pu;y[153]=mu;y[154]=yu;y[155]=gu;y[156]=P;y[157]=P;y[158]=P;y[159]=wu;for(let r=160;r<=183;r++)y[r]=bu;y[184]=vu;y[185]=Eu;y[186]=Du;y[187]=xu;y[188]=P;y[189]=P;y[190]=P;y[191]=_u;for(let r=192;r<=215;r++)y[r]=Au;y[216]=Cu;y[217]=Su;y[218]=Tu;y[219]=Iu;y[220]=P;y[221]=P;y[222]=P;y[223]=P;for(let r=224;r<=243;r++)y[r]=Xn("simple values are not supported");y[244]=P;y[245]=P;y[246]=P;y[247]=Ou;y[248]=Xn("simple values are not supported");y[249]=ku;y[250]=Nu;y[251]=Bu;y[252]=P;y[253]=P;y[254]=P;y[255]=Pu;var Oe=[];for(let r=0;r<24;r++)Oe[r]=new w(d.uint,r,1);for(let r=-1;r>=-24;r--)Oe[31-r]=new w(d.negint,r,1);Oe[64]=new w(d.bytes,new Uint8Array(0),1);Oe[96]=new w(d.string,"",1);Oe[128]=new w(d.array,0,1);Oe[160]=new w(d.map,0,1);Oe[244]=new w(d.false,!1,1);Oe[245]=new w(d.true,!0,1);Oe[246]=new w(d.null,null,1);function $u(r){switch(r.type){case d.false:return Ue([244]);case d.true:return Ue([245]);case d.null:return Ue([246]);case d.bytes:return r.value.length?void 0:Ue([64]);case d.string:return r.value===""?Ue([96]):void 0;case d.array:return r.value===0?Ue([128]):void 0;case d.map:return r.value===0?Ue([160]):void 0;case d.uint:return r.value<24?Ue([Number(r.value)]):void 0;case d.negint:if(r.value>=-24)return Ue([31-Number(r.value)])}}var wy={float64:!1,mapSorter:Ey,quickEncodeToken:$u};function by(){let r=[];return r[d.uint.major]=_e,r[d.negint.major]=Wn,r[d.bytes.major]=cr,r[d.string.major]=du,r[d.array.major]=Qn,r[d.map.major]=Gn,r[d.tag.major]=Jn,r[d.float.major]=Yn,r}var Uu=by(),Fi=new jr,lr=class{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${ki} object contains circular references`);return new lr(t,e)}},it={null:new w(d.null,null),undefined:new w(d.undefined,void 0),true:new w(d.true,!0),false:new w(d.false,!1),emptyArray:new w(d.array,0),emptyMap:new w(d.map,0)},st={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new w(d.float,r):r>=0?new w(d.uint,r):new w(d.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new w(d.uint,r):new w(d.negint,r)},Uint8Array(r,e,t,n){return new w(d.bytes,r)},string(r,e,t,n){return new w(d.string,r)},boolean(r,e,t,n){return r?it.true:it.false},null(r,e,t,n){return it.null},undefined(r,e,t,n){return it.undefined},ArrayBuffer(r,e,t,n){return new w(d.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new w(d.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[it.emptyArray,new w(d.break)]:it.emptyArray;n=lr.createCheck(n,r);let o=[],i=0;for(let s of r)o[i++]=Zn(s,t,n);return t.addBreakTokens?[new w(d.array,r.length),o,new w(d.break)]:[new w(d.array,r.length),o]},Object(r,e,t,n){let o=e!=="Object",i=o?r.keys():Object.keys(r),s=o?r.size:i.length;if(!s)return t.addBreakTokens===!0?[it.emptyMap,new w(d.break)]:it.emptyMap;n=lr.createCheck(n,r);let a=[],c=0;for(let f of i)a[c++]=[Zn(f,t,n),Zn(o?r.get(f):r[f],t,n)];return vy(a,t),t.addBreakTokens?[new w(d.map,s),a,new w(d.break)]:[new w(d.map,s),a]}};st.Map=st.Object;st.Buffer=st.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))st[`${r}Array`]=st.DataView;function Zn(r,e={},t){let n=Mc(r),o=e&&e.typeEncoders&&e.typeEncoders[n]||st[n];if(typeof o=="function"){let s=o(r,n,e,t);if(s!=null)return s}let i=st[n];if(!i)throw new Error(`${ki} unsupported type: ${n}`);return i(r,n,e,t)}function vy(r,e){e.mapSorter&&r.sort(e.mapSorter)}function Ey(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let o=t.type.major,i=Uu[o].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function zu(r,e,t,n){if(Array.isArray(e))for(let o of e)zu(r,o,t,n);else t[e.type.major](r,e,n)}function Dy(r,e,t){let n=Zn(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let o=t.quickEncodeToken(n);if(o)return o;let i=e[n.type.major];if(i.encodedSize){let s=i.encodedSize(n,t),a=new jr(s);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return Pi(a.chunks[0])}}return Fi.reset(),zu(Fi,n,e,t),Fi.toBytes(!0)}function It(r,e){return e=Object.assign({},wy,e),Dy(r,Uu,e)}var xy={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Mi=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Oe[e];if(t===void 0){let n=y[e];if(!n)throw new Error(`${x} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let o=e&31;t=n(this.data,this.pos,o,this.options)}return this.pos+=t.encodedLength,t}},Wr=Symbol.for("DONE"),eo=Symbol.for("BREAK");function _y(r,e,t){let n=[];for(let o=0;o<r.value;o++){let i=Hr(e,t);if(i===eo){if(r.value===1/0)break;throw new Error(`${x} got unexpected break to lengthed array`)}if(i===Wr)throw new Error(`${x} found array but not enough entries (got ${o}, expected ${r.value})`);n[o]=i}return n}function Ay(r,e,t){let n=t.useMaps===!0,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<r.value;s++){let a=Hr(e,t);if(a===eo){if(r.value===1/0)break;throw new Error(`${x} got unexpected break to lengthed map`)}if(a===Wr)throw new Error(`${x} found map but not enough entries (got ${s} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${x} non-string keys not supported (got ${typeof a})`);let c=Hr(e,t);if(c===Wr)throw new Error(`${x} found map but not enough entries (got ${s} [no value], expected ${r.value})`);n?i.set(a,c):o[a]=c}return n?i:o}function Hr(r,e){if(r.done())return Wr;let t=r.next();if(t.type===d.break)return eo;if(t.type.terminal)return t.value;if(t.type===d.array)return _y(t,r,e);if(t.type===d.map)return Ay(t,r,e);if(t.type===d.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=Hr(r,e);return e.tags[t.value](n)}throw new Error(`${x} tag not supported (${t.value})`)}throw new Error("unsupported")}function ze(r,e){if(!(r instanceof Uint8Array))throw new Error(`${x} data to decode must be a Uint8Array`);e=Object.assign({},xy,e);let t=e.tokenizer||new Mi(r,e),n=Hr(t,e);if(n===Wr)throw new Error(`${x} did not find any content to decode`);if(n===eo)throw new Error(`${x} got unexpected break`);if(!t.done())throw new Error(`${x} too many terminals, data makes no sense`);return n}var kt=S(ft(),1),Uf=kt.default.Reader,Ry=kt.default.Writer,X8=kt.default.util,io=kt.default.roots.default||(kt.default.roots.default={}),zf=io.ipfs=(()=>{let r={};return r.pin=function(){let e={};return e.Set=function(){function t(n){if(n)for(var o=Object.keys(n),i=0;i<o.length;++i)n[o[i]]!=null&&(this[o[i]]=n[o[i]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(o,i){return i||(i=Ry.create()),o.version!=null&&Object.hasOwnProperty.call(o,"version")&&i.uint32(8).uint32(o.version),o.fanout!=null&&Object.hasOwnProperty.call(o,"fanout")&&i.uint32(16).uint32(o.fanout),o.seed!=null&&Object.hasOwnProperty.call(o,"seed")&&i.uint32(29).fixed32(o.seed),i},t.decode=function(o,i){o instanceof Uf||(o=Uf.create(o));for(var s=i===void 0?o.len:o.pos+i,a=new io.ipfs.pin.Set;o.pos<s;){var c=o.uint32();switch(c>>>3){case 1:a.version=o.uint32();break;case 2:a.fanout=o.uint32();break;case 3:a.seed=o.fixed32();break;default:o.skipType(c&7);break}}return a},t.fromObject=function(o){if(o instanceof io.ipfs.pin.Set)return o;var i=new io.ipfs.pin.Set;return o.version!=null&&(i.version=o.version>>>0),o.fanout!=null&&(i.fanout=o.fanout>>>0),o.seed!=null&&(i.seed=o.seed>>>0),i},t.toObject=function(o,i){i||(i={});var s={};return i.defaults&&(s.version=0,s.fanout=0,s.seed=0),o.version!=null&&o.hasOwnProperty("version")&&(s.version=o.version),o.fanout!=null&&o.hasOwnProperty("fanout")&&(s.fanout=o.fanout),o.seed!=null&&o.hasOwnProperty("seed")&&(s.seed=o.seed),s},t.prototype.toJSON=function(){return this.constructor.toObject(this,kt.default.util.toJSONOptions)},t}(),e}(),r})();var cl=S(qf(),1),lo=S(Yr(),1);var Xr=new D("/local/pins"),ao=256,Zf=8192,ts=I.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),Nt={direct:"direct",recursive:"recursive"};function rs(r){return new D(`/${se.encode(r.multihash.bytes).toUpperCase().substring(1)}`)}function hr(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function co(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?hr(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function uo(r,e){e||(e=r.reduce((o,i)=>o+i.length,0));let t=co(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return hr(t)}function el(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}var ns={};R(ns,{identity:()=>Gy});var Gy=Xt({prefix:"\0",name:"identity",encode:r=>Qa(r),decode:r=>Ha(r)});var os={};R(os,{base2:()=>Jy});var Jy=K({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var is={};R(is,{base8:()=>Yy});var Yy=K({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ss={};R(ss,{base10:()=>Xy});var Xy=nt({prefix:"9",name:"base10",alphabet:"0123456789"});var as={};R(as,{base16:()=>Zy,base16upper:()=>eg});var Zy=K({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),eg=K({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var cs={};R(cs,{base36:()=>tg,base36upper:()=>rg});var tg=nt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rg=nt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var us={};R(us,{base64:()=>ng,base64pad:()=>og,base64url:()=>ig,base64urlpad:()=>sg});var ng=K({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),og=K({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ig=K({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),sg=K({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var fs={};R(fs,{base256emoji:()=>lg});var tl=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ag=tl.reduce((r,e,t)=>(r[t]=e,r),[]),cg=tl.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function ug(r){return r.reduce((e,t)=>(e+=ag[t],e),"")}function fg(r){let e=[];for(let t of r){let n=cg[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var lg=Xt({prefix:"\u{1F680}",name:"base256emoji",encode:ug,decode:fg});var hs={};R(hs,{sha256:()=>pr,sha512:()=>dg});var ds=({name:r,code:e,encode:t})=>new ls(r,e,t),ls=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?_t(this.code,t):t.then(n=>_t(this.code,n))}else throw Error("Unknown type, must be binary type")}};var nl=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),pr=ds({name:"sha2-256",code:18,encode:nl("SHA-256")}),dg=ds({name:"sha2-512",code:19,encode:nl("SHA-512")});var ps={};R(ps,{identity:()=>mg});var ol=0,hg="identity",il=He,pg=r=>_t(ol,il(r)),mg={code:ol,name:hg,encode:il,digest:pg};var C1=new TextEncoder,S1=new TextDecoder;var ms={...ns,...os,...is,...ss,...as,...ii,...cs,...oi,...us,...fs},P1={...hs,...ps};function al(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var sl=al("utf8","u",r=>{let e=new TextDecoder("utf8");return"u"+e.decode(r)},r=>new TextEncoder().encode(r.substring(1))),ys=al("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=co(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),gg={utf8:sl,"utf-8":sl,hex:ms.base16,latin1:ys,ascii:ys,binary:ys,...ms},fo=gg;function mr(r,e="utf8"){let t=fo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function yr(r,e="utf8"){let t=fo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?hr(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var gs=zf.pin.Set;function wg(r){let e=r.Data;if(!e)throw new Error("No data present");let t=lo.default.decode(e),n=lo.default.decode.bytes;if(n<=0)throw new Error("Invalid Set header length");if(n+t>e.length)throw new Error("Impossibly large set header length");let o=e.slice(n,t+n),i=gs.toObject(gs.decode(o),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(i.version!==1)throw new Error(`Unsupported Set version: ${i.version}`);if(i.fanout>r.Links.length)throw new Error("Impossibly large fanout");return{header:i,data:e.slice(t+n)}}function bg(r,e){let t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,r,!0);let o=yr(e.toString()),i=uo([t,o],t.byteLength+o.byteLength);return(0,cl.default)(mr(i))}async function*ul(r,e){let t=wg(e),n=0;for(let o of e.Links){if(n<t.header.fanout){let i=o.Hash;if(!ts.equals(i)){let s=await r.get(i),a=zr(s);yield*ul(r,a)}}else yield o.Hash;n++}}async function*Zr(r,e,t){let n=e.Links.find(s=>s.Name===t);if(!n)throw new Error("No link found with name "+t);let o=await r.get(n.Hash),i=zr(o);yield*ul(r,i)}function vg(r,e){return t(e,0);async function t(n,o){let i=gs.encode({version:1,fanout:ao,seed:o}).finish(),s=lo.default.encode(i.length),a=uo([s,i]),c=[];for(let u=0;u<ao;u++)c.push({Name:"",Tsize:1,Hash:ts});if(n.length<=Zf){let u=n.map(g=>({link:{Name:"",Tsize:1,Hash:g.key},data:g.data||new Uint8Array})).sort((g,h)=>el(g.link.Hash.bytes,h.link.Hash.bytes)),l=c.concat(u.map(g=>g.link));return{Data:uo([a,...u.map(g=>g.data)]),Links:l}}else{let u=n.reduce((p,g)=>{let h=bg(o,g.key)%ao;return p[h]=h in p?p[h].concat([g]):[g],p},[]),l=0;for(let p of u){let g=await t(p,o+1);await f(g,l),l++}return{Data:a,Links:c}}async function f(u,l){let p=Ur(u),g=await pr.digest(p),h=I.createV0(g);await r.put(h,p);let m=u.Links.reduce((_,T)=>_+(T.Tsize||0),0)+p.length;c[l]={Name:"",Tsize:m,Hash:h}}}}async function ws(r,e,t){let n=await vg(r,t.map(c=>({key:c}))),o=Ur(n),i=await pr.digest(o),s=I.createV0(i);await r.put(s,o);let a=n.Links.reduce((c,f)=>c+f.Tsize,0)+o.length;return{Name:e,Tsize:a,Hash:s}}var ho=S(Ii(),1);async function Dg(r,e,t,n){if(!await e.has(Xr))return;let o=await e.get(Xr),i=I.decode(o),s=await r.get(i),a=zr(s),c=0,f=await(0,ho.default)(Zr(r,a,Nt.recursive))+await(0,ho.default)(Zr(r,a,Nt.direct));for await(let u of Zr(r,a,Nt.recursive)){c++;let l={depth:1/0};u.version!==0&&(l.version=u.version),u.code!==Vn&&(l.codec=u.code),await t.put(rs(u),It(l)),n(c/f*100,`Migrated recursive pin ${u}`)}for await(let u of Zr(r,a,Nt.direct)){c++;let l={depth:0};u.version!==0&&(l.version=u.version),u.code!==Vn&&(l.codec=u.code),await t.put(rs(u),It(l)),n(c/f*100,`Migrated direct pin ${u}`)}await r.delete(i),await e.delete(Xr)}async function xg(r,e,t,n){let o=[],i=[],s=0,a=await(0,ho.default)(t.queryKeys({}));for await(let{key:p,value:g}of t.query({})){s++;let h=ze(g),m=I.create(h.version||0,h.codec||Vn,Yt(se.decode("b"+p.toString().toLowerCase().split("/").pop())));h.depth===0?(n(s/a*100,`Reverted direct pin ${m}`),i.push(m)):(n(s/a*100,`Reverted recursive pin ${m}`),o.push(m))}n(100,"Updating pin root");let c={Links:[await ws(r,Nt.direct,i),await ws(r,Nt.recursive,o)]},f=Ur(c),u=await pr.digest(f),l=I.createV0(u);await r.put(l,f),await e.put(Xr,l.bytes)}async function fl(r,e,t){let n=r.blocks,o=r.datastore,i=r.pins;await n.open(),await o.open(),await i.open();try{await t(n,o,i,e)}finally{await i.close(),await o.close(),await n.close()}}var ll={version:9,description:"Migrates pins to datastore",migrate:(r,e=()=>{})=>fl(r,e,Dg),revert:(r,e=()=>{})=>fl(r,e,xg)};var dl=S(We(),1);function en(r){return r=r||new Error("Not Found"),(0,dl.default)(r,"ERR_NOT_FOUND")}var hl=new D("/config"),tn=new D("/version");function rn(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function _g(r,e,t){let n=await e(r);if(n)return n;let o=rn(t);return o?new Promise((i,s)=>{let a=o.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{i(Boolean(a.result))}}):!1}async function Ag(r,e,t,n){if(await t(r))return e(r);let o=rn(n);if(!o)throw en();return new Promise((i,s)=>{let a=o.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return i(a.result);s(en())}})}function po(r){let e=r.get.bind(r),t=r.has.bind(r);return r.get=n=>Ag(n,e,t,r),r.has=n=>_g(n,t,r),r}function bs(r){return{...r,root:po(r.root),datastore:po(r.datastore),pins:po(r.pins),keys:po(r.keys)}}async function Cg(r,e,t=()=>{}){let n=rn(e);if(!n){t(`${r} did not need an upgrade`);return}t(`Upgrading ${r}`),await gl(n,(i,s)=>[{type:"del",key:i},{type:"put",key:yr(i),value:s}])}async function Sg(r,e,t=()=>{}){let n=rn(e);if(!n){t(`${r} did not need a downgrade`);return}t(`Downgrading ${r}`),await gl(n,(i,s)=>[{type:"del",key:i},{type:"put",key:mr(i),value:s}])}function ml(r){return r.child?ml(r.child):r}async function pl(r,e,t){let n=Object.entries(r).map(([s,a])=>({key:s,backend:ml(a)})).filter(({key:s,backend:a})=>a.constructor.name==="LevelDatastore").map(({key:s,backend:a})=>({name:s,store:a}));e(0,`Migrating ${n.length} dbs`);let o=0,i=s=>{e(Math.round(o/n.length*100),s)};for(let{name:s,store:a}of n){await a.open();try{await t(s,a,i)}finally{o++,await a.close()}}e(100,`Migrated ${n.length} dbs`)}var yl={version:10,description:"Migrates datastore-level keys to binary",migrate:(r,e=()=>{})=>pl(r,e,Cg),revert:(r,e=()=>{})=>pl(r,e,Sg)};function gl(r,e){function t(n,o){let i=r.store("readwrite"),s=i.transaction,a=0,c;s.onabort=()=>o(c||s.error||new Error("aborted by user")),s.oncomplete=()=>o();function f(){let u=n[a++],l=u.key,p;try{p=u.type==="del"?i.delete(l):i.put(u.value,l)}catch(g){c=g,s.abort();return}a<n.length&&(p.onsuccess=f)}f()}return new Promise((n,o)=>{let i=r.iterator(),s=c=>c;i._deserializeKey=i._deserializeValue=s,a();function a(){let c=(f,u,l)=>{if(f||u===void 0){let p=g=>{if(g){o(g);return}n()};i.end(p);return}t(e(u,l),a)};i.next(c)}})}var lt=new D("/local/filesroot");async function Tg(r,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await r.root.open(),await r.datastore.open(),await r.root.has(lt)){let t=await r.root.get(lt);await r.datastore.put(lt,t),await r.root.delete(lt)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo datastore")}async function Ig(r,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await r.root.open(),await r.datastore.open(),await r.datastore.has(lt)){let t=await r.datastore.get(lt);await r.root.put(lt,t),await r.datastore.delete(lt)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo root datastore")}var wl={version:11,description:"Store mfs root in the datastore",migrate:Tg,revert:Ig};var js=S(ft(),1);var Bt=S(ft(),1),bl=Bt.default.Reader,Og=Bt.default.Writer,Pg=Bt.default.util,mo=Bt.default.roots.default||(Bt.default.roots.default={}),vs=mo.Protocols=(()=>{function r(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.protocols=Pg.emptyArray,r.encode=function(t,n){if(n||(n=Og.create()),t.protocols!=null&&t.protocols.length)for(var o=0;o<t.protocols.length;++o)n.uint32(10).string(t.protocols[o]);return n},r.decode=function(t,n){t instanceof bl||(t=bl.create(t));for(var o=n===void 0?t.len:t.pos+n,i=new mo.Protocols;t.pos<o;){var s=t.uint32();switch(s>>>3){case 1:i.protocols&&i.protocols.length||(i.protocols=[]),i.protocols.push(t.string());break;default:t.skipType(s&7);break}}return i},r.fromObject=function(t){if(t instanceof mo.Protocols)return t;var n=new mo.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");n.protocols=[];for(var o=0;o<t.protocols.length;++o)n.protocols[o]=String(t.protocols[o])}return n},r.toObject=function(t,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.protocols=[]),t.protocols&&t.protocols.length){o.protocols=[];for(var i=0;i<t.protocols.length;++i)o.protocols[i]=t.protocols[i]}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,Bt.default.util.toJSONOptions)},r})();var Ye=S(ft(),1),gr=Ye.default.Reader,Es=Ye.default.Writer,F=Ye.default.util,ne=Ye.default.roots.default||(Ye.default.roots.default={}),Ds=ne.Addresses=(()=>{function r(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.addrs=F.emptyArray,r.prototype.certifiedRecord=null,r.encode=function(t,n){if(n||(n=Es.create()),t.addrs!=null&&t.addrs.length)for(var o=0;o<t.addrs.length;++o)ne.Addresses.Address.encode(t.addrs[o],n.uint32(10).fork()).ldelim();return t.certifiedRecord!=null&&Object.hasOwnProperty.call(t,"certifiedRecord")&&ne.Addresses.CertifiedRecord.encode(t.certifiedRecord,n.uint32(18).fork()).ldelim(),n},r.decode=function(t,n){t instanceof gr||(t=gr.create(t));for(var o=n===void 0?t.len:t.pos+n,i=new ne.Addresses;t.pos<o;){var s=t.uint32();switch(s>>>3){case 1:i.addrs&&i.addrs.length||(i.addrs=[]),i.addrs.push(ne.Addresses.Address.decode(t,t.uint32()));break;case 2:i.certifiedRecord=ne.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(s&7);break}}return i},r.fromObject=function(t){if(t instanceof ne.Addresses)return t;var n=new ne.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");n.addrs=[];for(var o=0;o<t.addrs.length;++o){if(typeof t.addrs[o]!="object")throw TypeError(".Addresses.addrs: object expected");n.addrs[o]=ne.Addresses.Address.fromObject(t.addrs[o])}}if(t.certifiedRecord!=null){if(typeof t.certifiedRecord!="object")throw TypeError(".Addresses.certifiedRecord: object expected");n.certifiedRecord=ne.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return n},r.toObject=function(t,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.addrs=[]),n.defaults&&(o.certifiedRecord=null),t.addrs&&t.addrs.length){o.addrs=[];for(var i=0;i<t.addrs.length;++i)o.addrs[i]=ne.Addresses.Address.toObject(t.addrs[i],n)}return t.certifiedRecord!=null&&t.hasOwnProperty("certifiedRecord")&&(o.certifiedRecord=ne.Addresses.CertifiedRecord.toObject(t.certifiedRecord,n)),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,Ye.default.util.toJSONOptions)},r.Address=function(){function e(n){if(n)for(var o=Object.keys(n),i=0;i<o.length;++i)n[o[i]]!=null&&(this[o[i]]=n[o[i]])}e.prototype.multiaddr=F.newBuffer([]),e.prototype.isCertified=null;let t;return Object.defineProperty(e.prototype,"_isCertified",{get:F.oneOfGetter(t=["isCertified"]),set:F.oneOfSetter(t)}),e.encode=function(o,i){return i||(i=Es.create()),o.multiaddr!=null&&Object.hasOwnProperty.call(o,"multiaddr")&&i.uint32(10).bytes(o.multiaddr),o.isCertified!=null&&Object.hasOwnProperty.call(o,"isCertified")&&i.uint32(16).bool(o.isCertified),i},e.decode=function(o,i){o instanceof gr||(o=gr.create(o));for(var s=i===void 0?o.len:o.pos+i,a=new ne.Addresses.Address;o.pos<s;){var c=o.uint32();switch(c>>>3){case 1:a.multiaddr=o.bytes();break;case 2:a.isCertified=o.bool();break;default:o.skipType(c&7);break}}return a},e.fromObject=function(o){if(o instanceof ne.Addresses.Address)return o;var i=new ne.Addresses.Address;return o.multiaddr!=null&&(typeof o.multiaddr=="string"?F.base64.decode(o.multiaddr,i.multiaddr=F.newBuffer(F.base64.length(o.multiaddr)),0):o.multiaddr.length&&(i.multiaddr=o.multiaddr)),o.isCertified!=null&&(i.isCertified=Boolean(o.isCertified)),i},e.toObject=function(o,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.multiaddr="":(s.multiaddr=[],i.bytes!==Array&&(s.multiaddr=F.newBuffer(s.multiaddr)))),o.multiaddr!=null&&o.hasOwnProperty("multiaddr")&&(s.multiaddr=i.bytes===String?F.base64.encode(o.multiaddr,0,o.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(o.multiaddr):o.multiaddr),o.isCertified!=null&&o.hasOwnProperty("isCertified")&&(s.isCertified=o.isCertified,i.oneofs&&(s._isCertified="isCertified")),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ye.default.util.toJSONOptions)},e}(),r.CertifiedRecord=function(){function e(t){if(t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}return e.prototype.seq=F.Long?F.Long.fromBits(0,0,!0):0,e.prototype.raw=F.newBuffer([]),e.encode=function(n,o){return o||(o=Es.create()),n.seq!=null&&Object.hasOwnProperty.call(n,"seq")&&o.uint32(8).uint64(n.seq),n.raw!=null&&Object.hasOwnProperty.call(n,"raw")&&o.uint32(18).bytes(n.raw),o},e.decode=function(n,o){n instanceof gr||(n=gr.create(n));for(var i=o===void 0?n.len:n.pos+o,s=new ne.Addresses.CertifiedRecord;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:s.seq=n.uint64();break;case 2:s.raw=n.bytes();break;default:n.skipType(a&7);break}}return s},e.fromObject=function(n){if(n instanceof ne.Addresses.CertifiedRecord)return n;var o=new ne.Addresses.CertifiedRecord;return n.seq!=null&&(F.Long?(o.seq=F.Long.fromValue(n.seq)).unsigned=!0:typeof n.seq=="string"?o.seq=parseInt(n.seq,10):typeof n.seq=="number"?o.seq=n.seq:typeof n.seq=="object"&&(o.seq=new F.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0))),n.raw!=null&&(typeof n.raw=="string"?F.base64.decode(n.raw,o.raw=F.newBuffer(F.base64.length(n.raw)),0):n.raw.length&&(o.raw=n.raw)),o},e.toObject=function(n,o){o||(o={});var i={};if(o.defaults){if(F.Long){var s=new F.Long(0,0,!0);i.seq=o.longs===String?s.toString():o.longs===Number?s.toNumber():s}else i.seq=o.longs===String?"0":0;o.bytes===String?i.raw="":(i.raw=[],o.bytes!==Array&&(i.raw=F.newBuffer(i.raw)))}return n.seq!=null&&n.hasOwnProperty("seq")&&(typeof n.seq=="number"?i.seq=o.longs===String?String(n.seq):n.seq:i.seq=o.longs===String?F.Long.prototype.toString.call(n.seq):o.longs===Number?new F.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0):n.seq),n.raw!=null&&n.hasOwnProperty("raw")&&(i.raw=o.bytes===String?F.base64.encode(n.raw,0,n.raw.length):o.bytes===Array?Array.prototype.slice.call(n.raw):n.raw),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,Ye.default.util.toJSONOptions)},e}(),r})();var Xe=S(ft(),1),wr=Xe.default.Reader,xs=Xe.default.Writer,N=Xe.default.util,X=Xe.default.roots.default||(Xe.default.roots.default={}),_s=X.Peer=(()=>{function r(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}r.prototype.addresses=N.emptyArray,r.prototype.protocols=N.emptyArray,r.prototype.metadata=N.emptyArray,r.prototype.pubKey=null,r.prototype.peerRecordEnvelope=null;let e;return Object.defineProperty(r.prototype,"_pubKey",{get:N.oneOfGetter(e=["pubKey"]),set:N.oneOfSetter(e)}),Object.defineProperty(r.prototype,"_peerRecordEnvelope",{get:N.oneOfGetter(e=["peerRecordEnvelope"]),set:N.oneOfSetter(e)}),r.encode=function(n,o){if(o||(o=xs.create()),n.addresses!=null&&n.addresses.length)for(var i=0;i<n.addresses.length;++i)X.Address.encode(n.addresses[i],o.uint32(10).fork()).ldelim();if(n.protocols!=null&&n.protocols.length)for(var i=0;i<n.protocols.length;++i)o.uint32(18).string(n.protocols[i]);if(n.metadata!=null&&n.metadata.length)for(var i=0;i<n.metadata.length;++i)X.Metadata.encode(n.metadata[i],o.uint32(26).fork()).ldelim();return n.pubKey!=null&&Object.hasOwnProperty.call(n,"pubKey")&&o.uint32(34).bytes(n.pubKey),n.peerRecordEnvelope!=null&&Object.hasOwnProperty.call(n,"peerRecordEnvelope")&&o.uint32(42).bytes(n.peerRecordEnvelope),o},r.decode=function(n,o){n instanceof wr||(n=wr.create(n));for(var i=o===void 0?n.len:n.pos+o,s=new X.Peer;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:s.addresses&&s.addresses.length||(s.addresses=[]),s.addresses.push(X.Address.decode(n,n.uint32()));break;case 2:s.protocols&&s.protocols.length||(s.protocols=[]),s.protocols.push(n.string());break;case 3:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(X.Metadata.decode(n,n.uint32()));break;case 4:s.pubKey=n.bytes();break;case 5:s.peerRecordEnvelope=n.bytes();break;default:n.skipType(a&7);break}}return s},r.fromObject=function(n){if(n instanceof X.Peer)return n;var o=new X.Peer;if(n.addresses){if(!Array.isArray(n.addresses))throw TypeError(".Peer.addresses: array expected");o.addresses=[];for(var i=0;i<n.addresses.length;++i){if(typeof n.addresses[i]!="object")throw TypeError(".Peer.addresses: object expected");o.addresses[i]=X.Address.fromObject(n.addresses[i])}}if(n.protocols){if(!Array.isArray(n.protocols))throw TypeError(".Peer.protocols: array expected");o.protocols=[];for(var i=0;i<n.protocols.length;++i)o.protocols[i]=String(n.protocols[i])}if(n.metadata){if(!Array.isArray(n.metadata))throw TypeError(".Peer.metadata: array expected");o.metadata=[];for(var i=0;i<n.metadata.length;++i){if(typeof n.metadata[i]!="object")throw TypeError(".Peer.metadata: object expected");o.metadata[i]=X.Metadata.fromObject(n.metadata[i])}}return n.pubKey!=null&&(typeof n.pubKey=="string"?N.base64.decode(n.pubKey,o.pubKey=N.newBuffer(N.base64.length(n.pubKey)),0):n.pubKey.length&&(o.pubKey=n.pubKey)),n.peerRecordEnvelope!=null&&(typeof n.peerRecordEnvelope=="string"?N.base64.decode(n.peerRecordEnvelope,o.peerRecordEnvelope=N.newBuffer(N.base64.length(n.peerRecordEnvelope)),0):n.peerRecordEnvelope.length&&(o.peerRecordEnvelope=n.peerRecordEnvelope)),o},r.toObject=function(n,o){o||(o={});var i={};if((o.arrays||o.defaults)&&(i.addresses=[],i.protocols=[],i.metadata=[]),n.addresses&&n.addresses.length){i.addresses=[];for(var s=0;s<n.addresses.length;++s)i.addresses[s]=X.Address.toObject(n.addresses[s],o)}if(n.protocols&&n.protocols.length){i.protocols=[];for(var s=0;s<n.protocols.length;++s)i.protocols[s]=n.protocols[s]}if(n.metadata&&n.metadata.length){i.metadata=[];for(var s=0;s<n.metadata.length;++s)i.metadata[s]=X.Metadata.toObject(n.metadata[s],o)}return n.pubKey!=null&&n.hasOwnProperty("pubKey")&&(i.pubKey=o.bytes===String?N.base64.encode(n.pubKey,0,n.pubKey.length):o.bytes===Array?Array.prototype.slice.call(n.pubKey):n.pubKey,o.oneofs&&(i._pubKey="pubKey")),n.peerRecordEnvelope!=null&&n.hasOwnProperty("peerRecordEnvelope")&&(i.peerRecordEnvelope=o.bytes===String?N.base64.encode(n.peerRecordEnvelope,0,n.peerRecordEnvelope.length):o.bytes===Array?Array.prototype.slice.call(n.peerRecordEnvelope):n.peerRecordEnvelope,o.oneofs&&(i._peerRecordEnvelope="peerRecordEnvelope")),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Xe.default.util.toJSONOptions)},r})(),dv=X.Address=(()=>{function r(t){if(t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}r.prototype.multiaddr=N.newBuffer([]),r.prototype.isCertified=null;let e;return Object.defineProperty(r.prototype,"_isCertified",{get:N.oneOfGetter(e=["isCertified"]),set:N.oneOfSetter(e)}),r.encode=function(n,o){return o||(o=xs.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&o.uint32(10).bytes(n.multiaddr),n.isCertified!=null&&Object.hasOwnProperty.call(n,"isCertified")&&o.uint32(16).bool(n.isCertified),o},r.decode=function(n,o){n instanceof wr||(n=wr.create(n));for(var i=o===void 0?n.len:n.pos+o,s=new X.Address;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:s.multiaddr=n.bytes();break;case 2:s.isCertified=n.bool();break;default:n.skipType(a&7);break}}return s},r.fromObject=function(n){if(n instanceof X.Address)return n;var o=new X.Address;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?N.base64.decode(n.multiaddr,o.multiaddr=N.newBuffer(N.base64.length(n.multiaddr)),0):n.multiaddr.length&&(o.multiaddr=n.multiaddr)),n.isCertified!=null&&(o.isCertified=Boolean(n.isCertified)),o},r.toObject=function(n,o){o||(o={});var i={};return o.defaults&&(o.bytes===String?i.multiaddr="":(i.multiaddr=[],o.bytes!==Array&&(i.multiaddr=N.newBuffer(i.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(i.multiaddr=o.bytes===String?N.base64.encode(n.multiaddr,0,n.multiaddr.length):o.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),n.isCertified!=null&&n.hasOwnProperty("isCertified")&&(i.isCertified=n.isCertified,o.oneofs&&(i._isCertified="isCertified")),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,Xe.default.util.toJSONOptions)},r})(),hv=X.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value=N.newBuffer([]),r.encode=function(t,n){return n||(n=xs.create()),t.key!=null&&Object.hasOwnProperty.call(t,"key")&&n.uint32(10).string(t.key),t.value!=null&&Object.hasOwnProperty.call(t,"value")&&n.uint32(18).bytes(t.value),n},r.decode=function(t,n){t instanceof wr||(t=wr.create(t));for(var o=n===void 0?t.len:t.pos+n,i=new X.Metadata;t.pos<o;){var s=t.uint32();switch(s>>>3){case 1:i.key=t.string();break;case 2:i.value=t.bytes();break;default:t.skipType(s&7);break}}return i},r.fromObject=function(t){if(t instanceof X.Metadata)return t;var n=new X.Metadata;return t.key!=null&&(n.key=String(t.key)),t.value!=null&&(typeof t.value=="string"?N.base64.decode(t.value,n.value=N.newBuffer(N.base64.length(t.value)),0):t.value.length&&(n.value=t.value)),n},r.toObject=function(t,n){n||(n={});var o={};return n.defaults&&(o.key="",n.bytes===String?o.value="":(o.value=[],n.bytes!==Array&&(o.value=N.newBuffer(o.value)))),t.key!=null&&t.hasOwnProperty("key")&&(o.key=t.key),t.value!=null&&t.hasOwnProperty("value")&&(o.value=n.bytes===String?N.base64.encode(t.value,0,t.value.length):n.bytes===Array?Array.prototype.slice.call(t.value):t.value),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,Xe.default.util.toJSONOptions)},r})();var Rt=S(ft(),1),vl=Rt.default.Reader,kg=Rt.default.Writer,M=Rt.default.util,yo=Rt.default.roots.default||(Rt.default.roots.default={}),El=yo.Envelope=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.publicKey=M.newBuffer([]),r.prototype.payloadType=M.newBuffer([]),r.prototype.payload=M.newBuffer([]),r.prototype.signature=M.newBuffer([]),r.encode=function(t,n){return n||(n=kg.create()),t.publicKey!=null&&Object.hasOwnProperty.call(t,"publicKey")&&n.uint32(10).bytes(t.publicKey),t.payloadType!=null&&Object.hasOwnProperty.call(t,"payloadType")&&n.uint32(18).bytes(t.payloadType),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&n.uint32(26).bytes(t.payload),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&n.uint32(42).bytes(t.signature),n},r.decode=function(t,n){t instanceof vl||(t=vl.create(t));for(var o=n===void 0?t.len:t.pos+n,i=new yo.Envelope;t.pos<o;){var s=t.uint32();switch(s>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=t.bytes();break;case 5:i.signature=t.bytes();break;default:t.skipType(s&7);break}}return i},r.fromObject=function(t){if(t instanceof yo.Envelope)return t;var n=new yo.Envelope;return t.publicKey!=null&&(typeof t.publicKey=="string"?M.base64.decode(t.publicKey,n.publicKey=M.newBuffer(M.base64.length(t.publicKey)),0):t.publicKey.length&&(n.publicKey=t.publicKey)),t.payloadType!=null&&(typeof t.payloadType=="string"?M.base64.decode(t.payloadType,n.payloadType=M.newBuffer(M.base64.length(t.payloadType)),0):t.payloadType.length&&(n.payloadType=t.payloadType)),t.payload!=null&&(typeof t.payload=="string"?M.base64.decode(t.payload,n.payload=M.newBuffer(M.base64.length(t.payload)),0):t.payload.length&&(n.payload=t.payload)),t.signature!=null&&(typeof t.signature=="string"?M.base64.decode(t.signature,n.signature=M.newBuffer(M.base64.length(t.signature)),0):t.signature.length&&(n.signature=t.signature)),n},r.toObject=function(t,n){n||(n={});var o={};return n.defaults&&(n.bytes===String?o.publicKey="":(o.publicKey=[],n.bytes!==Array&&(o.publicKey=M.newBuffer(o.publicKey))),n.bytes===String?o.payloadType="":(o.payloadType=[],n.bytes!==Array&&(o.payloadType=M.newBuffer(o.payloadType))),n.bytes===String?o.payload="":(o.payload=[],n.bytes!==Array&&(o.payload=M.newBuffer(o.payload))),n.bytes===String?o.signature="":(o.signature=[],n.bytes!==Array&&(o.signature=M.newBuffer(o.signature)))),t.publicKey!=null&&t.hasOwnProperty("publicKey")&&(o.publicKey=n.bytes===String?M.base64.encode(t.publicKey,0,t.publicKey.length):n.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),t.payloadType!=null&&t.hasOwnProperty("payloadType")&&(o.payloadType=n.bytes===String?M.base64.encode(t.payloadType,0,t.payloadType.length):n.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),t.payload!=null&&t.hasOwnProperty("payload")&&(o.payload=n.bytes===String?M.base64.encode(t.payload,0,t.payload.length):n.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),t.signature!=null&&t.hasOwnProperty("signature")&&(o.signature=n.bytes===String?M.base64.encode(t.signature,0,t.signature.length):n.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,Rt.default.util.toJSONOptions)},r})();var dt=S(ft(),1),go=dt.default.Reader,Dl=dt.default.Writer,H=dt.default.util,Ne=dt.default.roots.default||(dt.default.roots.default={}),xl=Ne.PeerRecord=(()=>{function r(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.peerId=H.newBuffer([]),r.prototype.seq=H.Long?H.Long.fromBits(0,0,!0):0,r.prototype.addresses=H.emptyArray,r.encode=function(t,n){if(n||(n=Dl.create()),t.peerId!=null&&Object.hasOwnProperty.call(t,"peerId")&&n.uint32(10).bytes(t.peerId),t.seq!=null&&Object.hasOwnProperty.call(t,"seq")&&n.uint32(16).uint64(t.seq),t.addresses!=null&&t.addresses.length)for(var o=0;o<t.addresses.length;++o)Ne.PeerRecord.AddressInfo.encode(t.addresses[o],n.uint32(26).fork()).ldelim();return n},r.decode=function(t,n){t instanceof go||(t=go.create(t));for(var o=n===void 0?t.len:t.pos+n,i=new Ne.PeerRecord;t.pos<o;){var s=t.uint32();switch(s>>>3){case 1:i.peerId=t.bytes();break;case 2:i.seq=t.uint64();break;case 3:i.addresses&&i.addresses.length||(i.addresses=[]),i.addresses.push(Ne.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return i},r.fromObject=function(t){if(t instanceof Ne.PeerRecord)return t;var n=new Ne.PeerRecord;if(t.peerId!=null&&(typeof t.peerId=="string"?H.base64.decode(t.peerId,n.peerId=H.newBuffer(H.base64.length(t.peerId)),0):t.peerId.length&&(n.peerId=t.peerId)),t.seq!=null&&(H.Long?(n.seq=H.Long.fromValue(t.seq)).unsigned=!0:typeof t.seq=="string"?n.seq=parseInt(t.seq,10):typeof t.seq=="number"?n.seq=t.seq:typeof t.seq=="object"&&(n.seq=new H.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");n.addresses=[];for(var o=0;o<t.addresses.length;++o){if(typeof t.addresses[o]!="object")throw TypeError(".PeerRecord.addresses: object expected");n.addresses[o]=Ne.PeerRecord.AddressInfo.fromObject(t.addresses[o])}}return n},r.toObject=function(t,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.addresses=[]),n.defaults)if(n.bytes===String?o.peerId="":(o.peerId=[],n.bytes!==Array&&(o.peerId=H.newBuffer(o.peerId))),H.Long){var i=new H.Long(0,0,!0);o.seq=n.longs===String?i.toString():n.longs===Number?i.toNumber():i}else o.seq=n.longs===String?"0":0;if(t.peerId!=null&&t.hasOwnProperty("peerId")&&(o.peerId=n.bytes===String?H.base64.encode(t.peerId,0,t.peerId.length):n.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),t.seq!=null&&t.hasOwnProperty("seq")&&(typeof t.seq=="number"?o.seq=n.longs===String?String(t.seq):t.seq:o.seq=n.longs===String?H.Long.prototype.toString.call(t.seq):n.longs===Number?new H.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){o.addresses=[];for(var s=0;s<t.addresses.length;++s)o.addresses[s]=Ne.PeerRecord.AddressInfo.toObject(t.addresses[s],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,dt.default.util.toJSONOptions)},r.AddressInfo=function(){function e(t){if(t)for(var n=Object.keys(t),o=0;o<n.length;++o)t[n[o]]!=null&&(this[n[o]]=t[n[o]])}return e.prototype.multiaddr=H.newBuffer([]),e.encode=function(n,o){return o||(o=Dl.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&o.uint32(10).bytes(n.multiaddr),o},e.decode=function(n,o){n instanceof go||(n=go.create(n));for(var i=o===void 0?n.len:n.pos+o,s=new Ne.PeerRecord.AddressInfo;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:s.multiaddr=n.bytes();break;default:n.skipType(a&7);break}}return s},e.fromObject=function(n){if(n instanceof Ne.PeerRecord.AddressInfo)return n;var o=new Ne.PeerRecord.AddressInfo;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?H.base64.decode(n.multiaddr,o.multiaddr=H.newBuffer(H.base64.length(n.multiaddr)),0):n.multiaddr.length&&(o.multiaddr=n.multiaddr)),o},e.toObject=function(n,o){o||(o={});var i={};return o.defaults&&(o.bytes===String?i.multiaddr="":(i.multiaddr=[],o.bytes!==Array&&(i.multiaddr=H.newBuffer(i.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(i.multiaddr=o.bytes===String?H.base64.encode(n.multiaddr,0,n.multiaddr.length):o.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,dt.default.util.toJSONOptions)},e}(),r})();var _l="[a-fA-F\\d:]",ht=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${_l})|(?<=${_l})(?=\\s|$))`:"",Be="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Z="[a-fA-F\\d]{1,4}",wo=`
(?:
(?:${Z}:){7}(?:${Z}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Z}:){6}(?:${Be}|:${Z}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Z}:){5}(?::${Be}|(?::${Z}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Z}:){4}(?:(?::${Z}){0,1}:${Be}|(?::${Z}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Z}:){3}(?:(?::${Z}){0,2}:${Be}|(?::${Z}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Z}:){2}(?:(?::${Z}){0,3}:${Be}|(?::${Z}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Z}:){1}(?:(?::${Z}){0,4}:${Be}|(?::${Z}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Z}){0,5}:${Be}|(?::${Z}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Ng=new RegExp(`(?:^${Be}$)|(?:^${wo}$)`),Bg=new RegExp(`^${Be}$`),Rg=new RegExp(`^${wo}$`),As=r=>r&&r.exact?Ng:new RegExp(`(?:${ht(r)}${Be}${ht(r)})|(?:${ht(r)}${wo}${ht(r)})`,"g");As.v4=r=>r&&r.exact?Bg:new RegExp(`${ht(r)}${Be}${ht(r)}`,"g");As.v6=r=>r&&r.exact?Rg:new RegExp(`${ht(r)}${wo}${ht(r)}`,"g");var bo=As;function Cs(r){let e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}function Al(){return!1}var{toString:Lg}=Object.prototype;function Ss(r){return Lg.call(r)==="[object RegExp]"}var Cl={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function Ts(r,e={}){if(!Ss(r))throw new TypeError("Expected a RegExp instance");let t=Object.keys(Cl).map(o=>(typeof e[o]=="boolean"?e[o]:r[o])?Cl[o]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function vo(r,e,{timeout:t}={}){try{return Cs(()=>Ts(r).test(e),{timeout:t})()}catch(n){if(Al(n))return!1;throw n}}var Fg=15,Sl=45,Is={timeout:400};function Eo(r){return vo(bo({exact:!0}),r.slice(0,Sl),Is)}function Tl(r){return vo(bo.v6({exact:!0}),r.slice(0,Sl),Is)}function Il(r){return vo(bo.v4({exact:!0}),r.slice(0,Fg),Is)}var Ol=Il,Mg=Tl,Os=function(r){let e=0;if(r=r.toString().trim(),Ol(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Mg(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let i=Ol(t[n]),s;i&&(s=Os(t[n]),t[n]=U(s.slice(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,U(s.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}let o=new Uint8Array(e+16);for(n=0;n<t.length;n++){let i=parseInt(t[n],16);o[e++]=i>>8&255,o[e++]=i&255}return o}throw new Error("invalid ip address")},Pl=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let o=[];for(let i=0;i<t;i++)o.push(r[e+i]);return o.join(".")}if(t===16){let o=[];for(let i=0;i<t;i+=2)o.push(n.getUint16(e+i).toString(16));return o.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var nn={},Ps={},Ug=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[460,0,"quic"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];Ug.forEach(r=>{let e=zg(...r);Ps[e.code]=e,nn[e.name]=e});function zg(r,e,t,n,o){return{code:r,size:e,name:t,resolvable:Boolean(n),path:Boolean(o)}}function ee(r){if(typeof r=="number"){if(Ps[r]!=null)return Ps[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(nn[r]!=null)return nn[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var Ve=S(Yr(),1);function Ze(r,e){e==null&&(e=r.reduce((o,i)=>o+i.length,0));let t=Un(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return or(t)}function Bl(r,e){switch(ee(r).code){case 4:case 41:return qg(e);case 6:case 273:case 33:case 132:return Ll(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return Kg(e);case 421:return Gg(e);case 444:return Nl(e);case 445:return Nl(e);case 466:return Qg(e);default:return U(e,"base16")}}function Rl(r,e){switch(ee(r).code){case 4:return kl(e);case 41:return kl(e);case 6:case 273:case 33:case 132:return Ns(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return Vg(e);case 421:return Wg(e);case 444:return Jg(e);case 445:return Yg(e);case 466:return Hg(e);default:return pe(e,"base16")}}var ks=Object.values(Mr).map(r=>r.decoder),jg=function(){let r=ks[0].or(ks[1]);return ks.slice(2).forEach(e=>r=r.or(e)),r}();function kl(r){if(!Eo(r))throw new Error("invalid ip address");return Os(r)}function qg(r){let e=Pl(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Eo(e))throw new Error("invalid ip address");return e}function Ns(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function Ll(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function Vg(r){let e=pe(r),t=Uint8Array.from(Ve.default.encode(e.length));return Ze([t,e],t.length+e.length)}function Kg(r){let e=Ve.default.decode(r);if(r=r.slice(Ve.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return U(r)}function Wg(r){let e;r[0]==="Q"||r[0]==="1"?e=nr(ue.decode(`z${r}`)).bytes:e=A.parse(r).multihash.bytes;let t=Uint8Array.from(Ve.default.encode(e.length));return Ze([t,e],t.length+e.length)}function Hg(r){let e=jg.decode(r),t=Uint8Array.from(Ve.default.encode(e.length));return Ze([t,e],t.length+e.length)}function Qg(r){let e=Ve.default.decode(r),t=r.slice(Ve.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+U(t,"base64url")}function Gg(r){let e=Ve.default.decode(r),t=r.slice(Ve.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return U(t,"base58btc")}function Jg(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=ae.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ns(n);return Ze([t,o],t.length+o.length)}function Yg(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=ae.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Ns(n);return Ze([t,o],t.length+o.length)}function Nl(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=U(e,"base32"),o=Ll(t);return`${n}:${o}`}var br=S(Yr(),1);function Xg(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let o=t[n],i=ee(o);if(i.size===0){e.push([o]);continue}if(n++,n>=t.length)throw Ml("invalid address: "+r);if(i.path===!0){e.push([o,Ms(t.slice(n).join("/"))]);break}e.push([o,t[n]])}return e}function Zg(r){let e=[];return r.map(t=>{let n=_o(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),Ms(e.join("/"))}function ew(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=_o(e);return e.length>1?[t.code,Rl(t.code,e[1])]:[t.code]})}function Bs(r){return r.map(e=>{let t=_o(e);return e[1]!=null?[t.code,Bl(t.code,e[1])]:[t.code]})}function Rs(r){return xo(Ze(r.map(e=>{let t=_o(e),n=Uint8Array.from(br.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Ze([n,e[1]])),n})))}function Ls(r,e){return r.size>0?r.size/8:r.size===0?0:br.default.decode(e)+br.default.decode.bytes}function Do(r){let e=[],t=0;for(;t<r.length;){let n=br.default.decode(r,t),o=br.default.decode.bytes,i=ee(n),s=Ls(i,r.slice(t+o));if(s===0){e.push([n]),t+=o;continue}let a=r.slice(t+o,t+o+s);if(t+=s+o,t>r.length)throw Ml("Invalid address Uint8Array: "+U(r,"base16"));e.push([n,a])}return e}function Fs(r){let e=Do(r),t=Bs(e);return Zg(t)}function tw(r){r=Ms(r);let e=Xg(r),t=ew(e);return Rs(t)}function Fl(r){return tw(r)}function xo(r){let e=rw(r);if(e!=null)throw e;return Uint8Array.from(r)}function rw(r){try{Do(r)}catch(e){return e}}function Ms(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function Ml(r){return new Error("Error parsing address: "+r)}function _o(r){return ee(r[0])}var Us=S(Yr(),1);var jl=S(We(),1);function $l(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var vr=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},$s=function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},on,sn,an,Ul,ow=Symbol.for("nodejs.util.inspect.custom"),zl=[ee("dns").code,ee("dns4").code,ee("dns6").code,ee("dnsaddr").code],iw=[ee("p2p").code,ee("ipfs").code],sw=new Map,ql=Symbol.for("@multiformats/js-multiaddr/multiaddr");function aw(r){return Boolean(r?.[ql])}var et=class{constructor(e){if(on.set(this,void 0),sn.set(this,void 0),an.set(this,void 0),this[Ul]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=xo(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Fl(e)}else if(aw(e))this.bytes=xo(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return vr(this,on,"f")==null&&$s(this,on,Fs(this.bytes),"f"),vr(this,on,"f")}toJSON(){return this.toString()}toOptions(){let e=this.protoCodes(),t=this.toString().split("/").slice(1),n,o;if(t.length>2)zl.includes(e[0])&&iw.includes(e[1])?(n=ee("tcp").name,o=443):(n=ee(t[2]).name,o=parseInt(t[3]));else if(zl.includes(e[0]))n=ee("tcp").name,o=443;else throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e[0]===41||e[0]===55?6:4,host:t[1],transport:n,port:o}}protos(){return this.protoCodes().map(e=>Object.assign({},ee(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let o=Us.default.decode(t,n),i=Us.default.decode.bytes,s=ee(o);n+=Ls(s,t.slice(n+i))+i,e.push(o)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return vr(this,sn,"f")==null&&$s(this,sn,Do(this.bytes),"f"),vr(this,sn,"f")}stringTuples(){return vr(this,an,"f")==null&&$s(this,an,Bs(this.tuples()),"f"),vr(this,an,"f")}encapsulate(e){return e=new et(e),new et(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),o=n.lastIndexOf(t);if(o<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new et(n.slice(0,o))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new et(Rs(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===nn.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?U(ue.decode(`z${n}`),"base58btc"):U(A.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>ee(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return $l(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(i=>i.resolvable);if(t==null)return[this];let n=sw.get(t.name);if(n==null)throw(0,jl.default)(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new et(i))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(on=new WeakMap,sn=new WeakMap,an=new WeakMap,Ul=ql,ow)](){return this.inspect()}inspect(){return"<Multiaddr "+U(this.bytes,"base16")+" - "+Fs(this.bytes)+">"}};function zs(r){return new et(r)}js.default.util.Long=void 0;js.default.configure();async function cw(r,e=()=>{}){e(0,"Storing each peerstore key under a single datastore key"),await r.datastore.open();let t={},n=[];for await(let{key:o,value:i}of r.datastore.query({prefix:"/peers"})){n.push(o);let s=o.toString(),[a,c,f,u,l]=s.split("/");if(c==="peers"&&!!["protos","addrs","metadata","keys"].includes(f)&&!!u)if(t[u]=t[u]||{addresses:[],protocols:[],metadata:[]},f==="protos"){let p=vs.decode(i);t[u].protocols=p.protocols.sort()}else if(f==="addrs"){let p=Ds.decode(i);t[u].addresses=p.addrs.sort((g,h)=>zs(g.multiaddr).toString().localeCompare(zs(h.multiaddr).toString())),p.certifiedRecord&&p.certifiedRecord.raw&&(t[u].peerRecordEnvelope=p.certifiedRecord.raw)}else f==="metadata"?t[u].metadata.push({key:l,value:i}):f==="keys"&&(t[u].pubKey=i)}e(33,"Read peer data from store");for(let o of n)await r.datastore.delete(o);e(66,"Removed existing peer data from store");for(let o of Object.keys(t)){let i=t[o];i.metadata=i.metadata.sort((a,c)=>a.key.localeCompare(c.key));let s=_s.encode(i).finish();await r.datastore.put(new D(`/peers/${o}`),s)}await r.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function uw(r,e=()=>{}){e(0,"Storing each peerstore key under a multiple datastore keys"),await r.datastore.open();let t={},n=[];for await(let{key:o,value:i}of r.datastore.query({prefix:"/peers"})){n.push(o);let s=o.toString(),[a,c,f]=s.split("/");t[f]=_s.decode(i)}e(33,"Read peer data from store");for(let o of n)await r.datastore.delete(o);e(66,"Removed existing peer data from store");for(let[o,i]of Object.entries(t)){if(i.protocols&&i.protocols.length>0&&await r.datastore.put(new D(`/peers/protos/${o}`),vs.encode({protocols:i.protocols}).finish()),i.addresses&&i.addresses.length>0){let s=i.peerRecordEnvelope,a;if(s){let c=El.decode(s),f=xl.decode(c.payload);a={raw:s,seq:f.seq}}await r.datastore.put(new D(`/peers/addrs/${o}`),Ds.encode({addrs:i.addresses,certifiedRecord:a}).finish())}if(i.metadata&&i.metadata.length>0)for(let{key:s,value:a}of i.metadata)await r.datastore.put(new D(`/peers/metadata/${o}/${s}`),a);i.pubKey&&await r.datastore.put(new D(`/peers/keys/${o}`),i.pubKey)}await r.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}var Vl={version:12,description:"Store each peerstore peer under a single datastore key",migrate:cw,revert:uw};var Lt={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},Ao=[Object.assign({version:1},Lt),Object.assign({version:2},Lt),Object.assign({version:3},Lt),Object.assign({version:4},Lt),Object.assign({version:5},Lt),Object.assign({version:6},Lt),Object.assign({version:7},Lt),Tc,ll,yl,wl,Vl];var Kl=S(Me(),1);var qs={};R(qs,{InvalidValueError:()=>xr,MissingRepoOptionsError:()=>Ke,NonReversibleMigrationError:()=>Er,NotInitializedRepoError:()=>pt,RequiredParameterError:()=>Dr});var Er=class extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=Er.code,this.message=e}};Er.code="ERR_NON_REVERSIBLE_MIGRATION";var pt=class extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=pt.code,this.message=e}};pt.code="ERR_NOT_INITIALIZED_REPO";var Dr=class extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=Dr.code,this.message=e}};Dr.code="ERR_REQUIRED_PARAMETER";var xr=class extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=xr.code,this.message=e}};xr.code="ERR_INVALID_VALUE";var Ke=class extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=Ke.code,this.message=e}};Ke.code="ERR_MISSING_REPO_OPTIONS";var Vs=(0,Kl.default)("ipfs:repo:migrator:repo:init");async function Wl(r){if(!r)throw new Ke("Please pass repo options when trying to open a repo");let e=r.root;try{await e.open();let t=await e.has(tn),n=await e.has(hl);return!t||!n?(Vs(`Version entry present: ${t}`),Vs(`Config entry present: ${n}`),!1):!0}catch(t){return Vs("While checking if repo is initialized error was thrown: "+t.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function Ks(r){if(!await Wl(r))throw new pt("Repo is not initialized!");let e=r.root;await e.open();try{return parseInt(mr(await e.get(tn)))}finally{await e.close()}}async function cn(r,e){if(!e)throw new Ke("Please pass repo options when trying to open a repo");let t=e.root;await t.open(),await t.put(tn,yr(String(r))),await t.close()}var Hl=S(Me(),1),Re=(0,Hl.default)("ipfs:repo:migrator");function lw(r){return r=r||Ao,!Array.isArray(r)||r.length===0?0:r[r.length-1].version}async function Ql(r,e,t,n,o={}){let i=o.ignoreLock??!1,s=o.onProgress,a=o.isDryRun??!1,c=o.migrations??Ao;if(!r)throw new Se.RequiredParameterError("Path argument is required!");if(!t)throw new Se.RequiredParameterError("repoOptions argument is required!");if(!n)throw new Se.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new Se.InvalidValueError("Version has to be positive integer!");e=bs(e);let f=await Ks(e);if(f===n){Re("Nothing to migrate.");return}if(f>n)throw new Se.InvalidValueError(`Current repo's version (${f}) is higher then toVersion (${n}), you probably wanted to revert it?`);Jl(c,f,n);let u;!a&&!i&&(u=await t.repoLock.lock(r));try{for(let l of c){if(n!==void 0&&l.version>n)break;if(!(l.version<=f)){Re(`Migrating version ${l.version}`);try{if(!a){let p=()=>{};s&&(p=(g,h)=>s(l.version,g.toFixed(2),h)),await l.migrate(e,p)}}catch(p){let g=l.version-1;throw Re(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${g}`),await cn(g,e),new Error(`During migration to version ${l.version} exception was raised: ${p.stack||p.message||p}`)}Re(`Migrating to version ${l.version} finished`)}}a||await cn(n||lw(c),e),Re("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!a&&!i&&u&&await u.close()}}async function Gl(r,e,t,n,o={}){let i=o.ignoreLock??!1,s=o.onProgress,a=o.isDryRun??!1,c=o.migrations??Ao;if(!r)throw new Se.RequiredParameterError("Path argument is required!");if(!t)throw new Se.RequiredParameterError("repoOptions argument is required!");if(!n)throw new Se.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new Se.InvalidValueError("Version has to be positive integer!");e=bs(e);let f=await Ks(e);if(f===n){Re("Nothing to revert.");return}if(f<n)throw new Se.InvalidValueError(`Current repo's version (${f}) is lower then toVersion (${n}), you probably wanted to migrate it?`);Jl(c,n,f,!0);let u;!a&&!i&&(u=await t.repoLock.lock(r)),Re(`Reverting from version ${f} to ${n}`);try{let l=c.slice().reverse();for(let p of l){if(p.version<=n)break;if(!(p.version>f)){Re(`Reverting migration version ${p.version}`);try{if(!a){let g=()=>{};s&&(g=(h,m)=>s(p.version,h.toFixed(2),m)),await p.revert(e,g)}}catch(g){let h=p.version;throw Re(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${h}`),await cn(h,e),g.message=`During reversion to version ${p.version} exception was raised: ${g.message}`,g}Re(`Reverting to version ${p.version} finished`)}}a||await cn(n,e),Re(`All migrations successfully reverted to version ${n}!`)}finally{!a&&!i&&u&&await u.close()}}function Jl(r,e,t,n=!1){let o=0;for(let i of r){if(i.version>t)break;if(i.version>e){if(n&&!i.revert)throw new Se.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${i.version} is not reversible. Cancelling reversion.`);o++}}if(o!==t-e)throw new Se.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${t}`)}var Se=qs;var vh=S(Zl(),1);var cd=S(ad(),1),ud=cd.default;var hd=S(Me(),1);var Ft=class extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=Ft.code}};Ft.code="ERR_LOCK_EXISTS";var be=class extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=be.code}};be.code="ERR_NOT_FOUND";var Mt=class extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=Mt.code}};Mt.code="ERR_INVALID_REPO_VERSION";var un="ERR_REPO_NOT_INITIALIZED",fd="ERR_REPO_ALREADY_OPEN",ld="ERR_REPO_ALREADY_CLOSED";async function Io(r,e,t){let n=await e(r);if(n)return n;let o=dd(t);return o?new Promise((i,s)=>{let a=o.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{i(Boolean(a.result))}}):!1}async function Oo(r,e,t,n){if(await t(r))return e(r);let o=dd(n);if(!o)throw new be;return new Promise((i,s)=>{let a=o.store("readonly").get(r.toString());a.transaction.onabort=()=>{s(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return i(a.result);s(new be)}})}function dd(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}var _w=(0,hd.default)("ipfs:repo:version"),Hs=new D("version");function pd(r){return{async exists(){return Io(Hs,r.has.bind(r),r)},async get(){let e=await Oo(Hs,r.get.bind(r),r.has.bind(r),r);return parseInt(U(e),10)},set(e){return r.put(Hs,pe(String(e)))},async check(e){let t=await this.get();return _w("comparing version: %s and %s",t,e),t===e||(t===6&&e===7||e===6&&t===7)}}}var _d=S(Gs(),1);var ln=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Js=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},yd=r=>globalThis.DOMException===void 0?new Js(r):new DOMException(r),gd=r=>{let e=r.reason===void 0?yd("This operation was aborted."):r.reason;return e instanceof Error?e:yd(e)};function Ys(r,e,t,n){let o,i=new Promise((s,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){s(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:c}=n;c.aborted&&a(gd(c)),c.addEventListener("abort",()=>{a(gd(c))})}o=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{s(t())}catch(u){a(u)}return}let c=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,f=t instanceof Error?t:new ln(c);typeof r.cancel=="function"&&r.cancel(),a(f)},e),(async()=>{try{s(await r)}catch(c){a(c)}finally{n.customTimers.clearTimeout.call(void 0,o)}})()});return i.clear=()=>{clearTimeout(o),o=void 0},i}function Xs(r,e,t){let n=0,o=r.length;for(;o>0;){let i=Math.trunc(o/2),s=n+i;t(r[s],e)<=0?(n=++s,o-=i+1):o=i}return n}var $t=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},tt,dn=class{constructor(){tt.set(this,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&$t(this,tt,"f")[this.size-1].priority>=t.priority){$t(this,tt,"f").push(n);return}let o=Xs($t(this,tt,"f"),n,(i,s)=>s.priority-i.priority);$t(this,tt,"f").splice(o,0,n)}dequeue(){let e=$t(this,tt,"f").shift();return e?.run}filter(e){return $t(this,tt,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return $t(this,tt,"f").length}};tt=new WeakMap;var z=function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},b=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},J,pn,mn,gt,Fo,yn,ko,Le,hn,ve,No,Ee,gn,yt,Bo,wd,bd,xd,vd,Ed,Dd,Ro,Zs,ea,Mo,Lo,Sw=new ln,ta=class extends Error{},Ut=class extends _d.default{constructor(e){var t,n,o,i;if(super(),J.add(this),pn.set(this,void 0),mn.set(this,void 0),gt.set(this,0),Fo.set(this,void 0),yn.set(this,void 0),ko.set(this,0),Le.set(this,void 0),hn.set(this,void 0),ve.set(this,void 0),No.set(this,void 0),Ee.set(this,0),gn.set(this,void 0),yt.set(this,void 0),Bo.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:dn,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(o=e.interval)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);z(this,pn,e.carryoverConcurrencyCount,"f"),z(this,mn,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),z(this,Fo,e.intervalCap,"f"),z(this,yn,e.interval,"f"),z(this,ve,new e.queueClass,"f"),z(this,No,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,z(this,Bo,e.throwOnTimeout===!0,"f"),z(this,yt,e.autoStart===!1,"f")}get concurrency(){return b(this,gn,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);z(this,gn,e,"f"),b(this,J,"m",Mo).call(this)}async add(e,t={}){return new Promise((n,o)=>{let i=async()=>{var s,a,c;z(this,Ee,(a=b(this,Ee,"f"),a++,a),"f"),z(this,gt,(c=b(this,gt,"f"),c++,c),"f");try{if(!((s=t.signal)===null||s===void 0)&&s.aborted){o(new ta("The task was aborted."));return}let u=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):Ys(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?b(this,Bo,"f"):t.throwOnTimeout)&&o(Sw)}));n(u),this.emit("completed",u)}catch(f){o(f),this.emit("error",f)}b(this,J,"m",xd).call(this)};b(this,ve,"f").enqueue(i,t),b(this,J,"m",Ro).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return b(this,yt,"f")?(z(this,yt,!1,"f"),b(this,J,"m",Mo).call(this),this):this}pause(){z(this,yt,!0,"f")}clear(){z(this,ve,new(b(this,No,"f")),"f")}async onEmpty(){b(this,ve,"f").size!==0&&await b(this,J,"m",Lo).call(this,"empty")}async onSizeLessThan(e){b(this,ve,"f").size<e||await b(this,J,"m",Lo).call(this,"next",()=>b(this,ve,"f").size<e)}async onIdle(){b(this,Ee,"f")===0&&b(this,ve,"f").size===0||await b(this,J,"m",Lo).call(this,"idle")}get size(){return b(this,ve,"f").size}sizeBy(e){return b(this,ve,"f").filter(e).length}get pending(){return b(this,Ee,"f")}get isPaused(){return b(this,yt,"f")}};pn=new WeakMap,mn=new WeakMap,gt=new WeakMap,Fo=new WeakMap,yn=new WeakMap,ko=new WeakMap,Le=new WeakMap,hn=new WeakMap,ve=new WeakMap,No=new WeakMap,Ee=new WeakMap,gn=new WeakMap,yt=new WeakMap,Bo=new WeakMap,J=new WeakSet,wd=function(){return b(this,mn,"f")||b(this,gt,"f")<b(this,Fo,"f")},bd=function(){return b(this,Ee,"f")<b(this,gn,"f")},xd=function(){var e;z(this,Ee,(e=b(this,Ee,"f"),e--,e),"f"),b(this,J,"m",Ro).call(this),this.emit("next")},vd=function(){this.emit("empty"),b(this,Ee,"f")===0&&this.emit("idle")},Ed=function(){b(this,J,"m",ea).call(this),b(this,J,"m",Zs).call(this),z(this,hn,void 0,"f")},Dd=function(){let e=Date.now();if(b(this,Le,"f")===void 0){let t=b(this,ko,"f")-e;if(t<0)z(this,gt,b(this,pn,"f")?b(this,Ee,"f"):0,"f");else return b(this,hn,"f")===void 0&&z(this,hn,setTimeout(()=>{b(this,J,"m",Ed).call(this)},t),"f"),!0}return!1},Ro=function(){if(b(this,ve,"f").size===0)return b(this,Le,"f")&&clearInterval(b(this,Le,"f")),z(this,Le,void 0,"f"),b(this,J,"m",vd).call(this),!1;if(!b(this,yt,"f")){let e=!b(this,J,"a",Dd);if(b(this,J,"a",wd)&&b(this,J,"a",bd)){let t=b(this,ve,"f").dequeue();return t?(this.emit("active"),t(),e&&b(this,J,"m",Zs).call(this),!0):!1}}return!1},Zs=function(){b(this,mn,"f")||b(this,Le,"f")!==void 0||(z(this,Le,setInterval(()=>{b(this,J,"m",ea).call(this)},b(this,yn,"f")),"f"),z(this,ko,Date.now()+b(this,yn,"f"),"f"))},ea=function(){b(this,gt,"f")===0&&b(this,Ee,"f")===0&&b(this,Le,"f")&&(clearInterval(b(this,Le,"f")),z(this,Le,void 0,"f")),z(this,gt,b(this,pn,"f")?b(this,Ee,"f"):0,"f"),b(this,J,"m",Mo).call(this)},Mo=function(){for(;b(this,J,"m",Ro).call(this););},Lo=async function(e,t){return new Promise(n=>{let o=()=>{t&&!t()||(this.off(e,o),n())};this.on(e,o)})};var Cd=Tw;function Tw(r,e,t){var n,o;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(o=n.pop(),!o)return!1;Ad(o);for(var i;i=n.shift();)if(Ad(i),typeof r[i]>"u"&&(r[i]={}),r=r[i],!r||typeof r!="object")return!1;return r[o]=t,!0}function Ad(r){if(r=="__proto__"||r=="constructor"||r=="prototype")throw new Error("setting of prototype values not supported")}var $o=S(We(),1);var Iw=Ut.default?Ut.default:Ut,ra=new D("config");function Sd(r){let e=new Iw({concurrency:1}),t={async getAll(i={}){let s=await Oo(ra,r.get.bind(r),r.has.bind(r),r);return JSON.parse(U(s))},async get(i,s={}){if(i==null)throw new be(`Key ${i} does not exist in config`);let a=await this.getAll(s),c=Pr(a,i);if(c===void 0)throw new be(`Key ${i} does not exist in config`);return c},set(i,s,a={}){if(typeof i!="string"&&!(i instanceof String))throw(0,$o.default)(new Error("Invalid key type: "+typeof i),"ERR_INVALID_KEY");if(s===void 0||s instanceof Uint8Array)throw(0,$o.default)(new Error("Invalid value type: "+typeof s),"ERR_INVALID_VALUE");return e.add(()=>n({key:i,value:s},a.signal))},replace(i,s={}){if(!i||i instanceof Uint8Array)throw(0,$o.default)(new Error("Invalid value type: "+typeof i),"ERR_INVALID_VALUE");return e.add(()=>n({key:void 0,value:i},s.signal))},async exists(){return Io(ra,r.has.bind(r),r)}};return t;async function n(i,s){if(s&&s.aborted)return;let a=i.key,c=i.value;if(a){let f=await t.getAll();return typeof f=="object"&&f!==null&&Cd(f,a,c),o(f)}return o(c)}function o(i){let s=pe(JSON.stringify(i,null,2));return r.put(ra,s)}}function wn(r){if(typeof r!="object"||r===null)return!1;let e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function na(r,e={}){if(!wn(r)&&!Array.isArray(r))throw new TypeError("Expected a plain object or array");let{deep:t,compare:n}=e,o=[],i=[],s=c=>{let f=o.indexOf(c);if(f!==-1)return i[f];let u=[];return o.push(c),i.push(u),u.push(...c.map(l=>Array.isArray(l)?s(l):wn(l)?a(l):l)),u},a=c=>{let f=o.indexOf(c);if(f!==-1)return i[f];let u={},l=Object.keys(c).sort(n);o.push(c),i.push(u);for(let p of l){let g=c[p],h;t&&Array.isArray(g)?h=s(g):h=t&&wn(g)?a(g):g,Object.defineProperty(u,p,{...Object.getOwnPropertyDescriptor(c,p),value:h})}return u};return Array.isArray(r)?t?s(r):r.slice():a(r)}var oa=new D("datastore_spec");function Td(r){return{exists(){return r.has(oa)},async get(){let e=await r.get(oa);return JSON.parse(U(e))},async set(e){return r.put(oa,pe(JSON.stringify(na(e,{deep:!0}))))}}}var ia=new D("api");function Id(r){return{async get(){let e=await r.get(ia);return e&&e.toString()},set(e){return r.put(ia,pe(e.toString()))},delete(){return r.delete(ia)}}}async function*bn(r,e){for await(let t of r)await e(t)&&(yield t)}var Uo=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},Cr=class{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Uo(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Uo(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};function Sr(r={}){return Ow(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function Ow(r,e){e=e??{};let t=e.onEnd,n=new Cr,o,i,s,a=async()=>n.isEmpty()?s?{done:!0}:await new Promise((m,_)=>{i=T=>{i=null,n.push(T);try{m(r(n))}catch(B){_(B)}return o}}):r(n),c=m=>i!=null?i(m):(n.push(m),o),f=m=>(n=new Cr,i!=null?i({error:m}):(n.push({error:m}),o)),u=m=>{if(s)return o;if(e?.objectMode!==!0&&m?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:m})},l=m=>s?o:(s=!0,m!=null?f(m):c({done:!0})),p=()=>(n=new Cr,l(),{done:!0}),g=m=>(l(m),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:a,return:p,throw:g,push:u,end:l,get readableLength(){return n.size}},t==null)return o;let h=o;return o={[Symbol.asyncIterator](){return this},next(){return h.next()},throw(m){return h.throw(m),t!=null&&(t(m),t=void 0),{done:!0}},return(){return h.return(),t!=null&&(t(),t=void 0),{done:!0}},push:u,end(m){return h.end(m),t!=null&&(t(m),t=void 0),o},get readableLength(){return h.readableLength}},o}async function sa(r){for await(let e of r);}var Od=S(We(),1);function Pd(r){return{open(){return r.open()},close(){return r.close()},query(e,t){return r.query(e,t)},queryKeys(e,t){return r.queryKeys(e,t)},async get(e,t){let n=wt(e);return n.isIdentity?Promise.resolve(n.digest):r.get(e,t)},async*getMany(e,t){for await(let n of e)yield this.get(n,t)},async put(e,t,n){let{isIdentity:o}=wt(e);o||await r.put(e,t,n)},async*putMany(e,t){let n=Sr({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{await sa(r.putMany(async function*(){for await(let{key:i,value:s}of e)wt(i).isIdentity||(yield{key:i,value:s}),n.push({key:i,value:s})}())),n.end()}catch(i){n.end(i)}}),yield*n},has(e,t){let{isIdentity:n}=wt(e);return n?Promise.resolve(!0):r.has(e,t)},delete(e,t){let{isIdentity:n}=wt(e);return n?Promise.resolve():r.delete(e,t)},deleteMany(e,t){return r.deleteMany(bn(e,n=>!wt(n).isIdentity),t)},batch(){let e=r.batch();return{put(t,n){let{isIdentity:o}=wt(t);o||e.put(t,n)},delete(t){let{isIdentity:n}=wt(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function wt(r){let e=A.asCID(r);if(e==null)throw(0,Od.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==Ai.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}var kd=S(Me(),1),Nd=(0,kd.default)("ipfs:repo:lock:memory"),Bd="repo.lock",vn={};async function Pw(r){let e=r+"/"+Bd;if(Nd("locking %s",e),vn[e]===!0)throw new Ft(`Lock already being held for file: ${e}`);return vn[e]=!0,{async close(){vn[e]&&delete vn[e]}}}async function kw(r){let e=r+"/"+Bd;return Nd(`checking lock: ${e}`),Boolean(vn[e])}var Rd={lock:Pw,locked:kw};var Ld={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:Rd};var aa={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};var $d=S(We(),1),Ud=S(Me(),1);async function zo(r){for await(let e of r)return e}function jo({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*Nw(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[t,n]of e.entries()){let o=[...r,t],i=A.asCID(n);i?yield[o.join("/"),i]:typeof n=="object"&&(yield*ca(n,o))}else{let t=A.asCID(e);t?yield[r.join("/"),t]:yield*ca(e,r)}}function*ca(r,e){if(!(r==null||r instanceof Uint8Array))for(let[t,n]of Object.entries(r)){let o=[...e,t];yield*Nw(o,n)}}function*Bw(r,e){if(Array.isArray(e))for(let[t,n]of e.entries()){let o=[...r,t];yield o.join("/"),typeof n=="object"&&!A.asCID(n)&&(yield*ua(n,o))}else yield*ua(e,r)}function*ua(r,e){if(!(r==null||typeof r!="object"))for(let[t,n]of Object.entries(r)){let o=[...e,t];yield o.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!A.asCID(n)&&(yield*Bw(o,n))}}function Rw(r,e){let t=r;for(let[n,o]of e.entries()){if(t=t[o],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let i=A.asCID(t);if(i)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}var fa=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:jo(),bytes:jo(),value:jo(),asBlock:jo()})}links(){return ca(this.value,[])}tree(){return ua(this.value,[])}get(e="/"){return Rw(this.value,e.split("/").filter(Boolean))}};function qo({bytes:r,cid:e,value:t,codec:n}){let o=t!==void 0?t:n&&n.decode(r);if(o===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new fa({cid:e,bytes:r,value:o})}var BD=new TextDecoder;var LD=new TextEncoder,FD=2**32,MD=2**31;var zD=new TextEncoder;var En=112;var Fd=S(We(),1);function Dn(r){let e=A.asCID(r);if(e==null)throw(0,Fd.default)(new Error("Not a valid cid"),"ERR_INVALID_CID");let t=ae.encode(e.multihash.bytes);return new D("/"+t.slice(1).toUpperCase(),!1)}function la(r){return nr(ae.decode(`b${r.toString().toLowerCase().substring(1)}`))}var Md=S(Me(),1);var Fw=(0,Md.default)("ipfs:repo:utils:walk-dag");async function*Tr(r,e,t,n){try{let o=await e.get(r,n),i=await t(r.code),s=qo({bytes:o,cid:r,codec:i});for(let[,a]of s.links())yield a,yield*Tr(a,e,t,n)}catch(o){throw Fw("Could not walk DAG for CID",r.toString(),o),o}}var le={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};var xn=class extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(let[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){let n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){let t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){let t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){let o=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:o}):this._set(e,{value:t,expiry:o})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){let t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");let t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(let[e]of this)yield e}*values(){for(let[,e]of this)yield e}*[Symbol.iterator](){for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){let n=e[t],[o,i]=n;this._deleteIfExpired(o,i)===!1&&(yield[o,i.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){let n=e[t],[o,i]=n;this.cache.has(o)||this._deleteIfExpired(o,i)===!1&&(yield[o,i.value])}}*entriesAscending(){for(let[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(let t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(let[n,o]of this.entriesAscending())e.call(t,o,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}};var Mw=2048;function $w(r){let e=`Invalid type '${r}', must be one of {direct, indirect, recursive, all}`;return(0,$d.default)(new Error(e),"ERR_INVALID_PIN_TYPE")}var Vo=class{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=(0,Ud.default)("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);let n={depth:0};return e.version!==0&&(n.version=e.version),e.code!==En&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(Dn(e),It(n))}unpin(e,t){return this.pinstore.delete(Dn(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);let n={depth:1/0};e.version!==0&&(n.version=e.version),e.code!==En&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(Dn(e),It(n))}async*directKeys(e){for await(let t of this.pinstore.query({filters:[n=>ze(n.value).depth===0]})){let n=ze(t.value),o=n.version||0,i=n.codec!=null?n.codec:En,s=la(t.key);yield{cid:A.create(o,i,s),metadata:n.metadata}}}async*recursiveKeys(e){for await(let t of this.pinstore.query({filters:[n=>ze(n.value).depth===1/0]})){let n=ze(t.value),o=n.version||0,i=n.codec!=null?n.codec:En,s=la(t.key);yield{cid:A.create(o,i,s),metadata:n.metadata}}}async*indirectKeys(e){for await(let{cid:t}of this.recursiveKeys())for await(let n of Tr(t,this.blockstore,this.loadCodec,e)){let o=[le.recursive];(await this.isPinnedWithType(n,o)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);let o=t.includes(le.all),i=t.includes(le.direct),s=t.includes(le.recursive),a=t.includes(le.indirect);if(s||i||o){let u=await zo(this.pinstore.query({prefix:Dn(e).toString(),filters:[l=>{if(o)return!0;let p=ze(l.value);return t.includes(p.depth===0?le.direct:le.recursive)}],limit:1}));if(u){let l=ze(u.value);return{cid:e,pinned:!0,reason:l.depth===0?le.direct:le.recursive,metadata:l.metadata}}}let c=this;async function*f(u,l){for await(let{cid:p}of l)for await(let g of Tr(p,c.blockstore,c.loadCodec))if(g.equals(u)){yield p;return}}if(o||a){let u=await zo(f(e,this.recursiveKeys()));if(u)return{cid:e,pinned:!0,reason:le.indirect,parent:u}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){let n=new xn({maxSize:t.cidCacheMaxSize??Mw}),o=async(i,s)=>{if(n.has(i.toString()))return;n.set(i.toString(),!0);let a=await this.blockstore.get(i,s),c=await this.loadCodec(i.code),f=qo({bytes:a,cid:i,codec:c});await Promise.all([...f.links()].map(([,u])=>o(u,s)))};await o(e,t)}static checkPinType(e){if(typeof e!="string"||!Object.keys(le).includes(e))throw $w(e);return!0}};async function*zt(r,e){for await(let t of r)yield e(t)}var jd=S(We(),1);function qd(r,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,o){await e.put(t,n,o)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(t,n){return await zd(t,r),e.delete(t,n)},deleteMany(t,n){return e.deleteMany(zt(t,async o=>(await zd(o,r),o)),n)},batch(){return e.batch()}}}async function zd(r,e){let{pinned:t,reason:n}=await e.isPinnedWithType(r,le.all);if(t)throw(0,jd.default)(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}var Xd=S(Gs(),1);var _n=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},da=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},Vd=r=>globalThis.DOMException===void 0?new da(r):new DOMException(r),Kd=r=>{let e=r.reason===void 0?Vd("This operation was aborted."):r.reason;return e instanceof Error?e:Vd(e)};function ha(r,e,t,n){let o,i=new Promise((s,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){s(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:c}=n;c.aborted&&a(Kd(c)),c.addEventListener("abort",()=>{a(Kd(c))})}o=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{s(t())}catch(u){a(u)}return}let c=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,f=t instanceof Error?t:new _n(c);typeof r.cancel=="function"&&r.cancel(),a(f)},e),(async()=>{try{s(await r)}catch(c){a(c)}finally{n.customTimers.clearTimeout.call(void 0,o)}})()});return i.clear=()=>{clearTimeout(o),o=void 0},i}function pa(r,e,t){let n=0,o=r.length;for(;o>0;){let i=Math.trunc(o/2),s=n+i;t(r[s],e)<=0?(n=++s,o-=i+1):o=i}return n}var jt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},rt,An=class{constructor(){rt.set(this,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&jt(this,rt,"f")[this.size-1].priority>=t.priority){jt(this,rt,"f").push(n);return}let o=pa(jt(this,rt,"f"),n,(i,s)=>s.priority-i.priority);jt(this,rt,"f").splice(o,0,n)}dequeue(){let e=jt(this,rt,"f").shift();return e?.run}filter(e){return jt(this,rt,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return jt(this,rt,"f").length}};rt=new WeakMap;var j=function(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t},v=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Y,Sn,Tn,vt,Jo,In,Ko,Fe,Cn,De,Wo,xe,On,bt,Ho,Wd,Hd,Yd,Qd,Gd,Jd,Qo,ma,ya,Yo,Go,Uw=new _n,ga=class extends Error{},Ir=class extends Xd.default{constructor(e){var t,n,o,i;if(super(),Y.add(this),Sn.set(this,void 0),Tn.set(this,void 0),vt.set(this,0),Jo.set(this,void 0),In.set(this,void 0),Ko.set(this,0),Fe.set(this,void 0),Cn.set(this,void 0),De.set(this,void 0),Wo.set(this,void 0),xe.set(this,0),On.set(this,void 0),bt.set(this,void 0),Ho.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:An,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(o=e.interval)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);j(this,Sn,e.carryoverConcurrencyCount,"f"),j(this,Tn,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),j(this,Jo,e.intervalCap,"f"),j(this,In,e.interval,"f"),j(this,De,new e.queueClass,"f"),j(this,Wo,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,j(this,Ho,e.throwOnTimeout===!0,"f"),j(this,bt,e.autoStart===!1,"f")}get concurrency(){return v(this,On,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);j(this,On,e,"f"),v(this,Y,"m",Yo).call(this)}async add(e,t={}){return new Promise((n,o)=>{let i=async()=>{var s,a,c;j(this,xe,(a=v(this,xe,"f"),a++,a),"f"),j(this,vt,(c=v(this,vt,"f"),c++,c),"f");try{if(!((s=t.signal)===null||s===void 0)&&s.aborted){o(new ga("The task was aborted."));return}let u=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):ha(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?v(this,Ho,"f"):t.throwOnTimeout)&&o(Uw)}));n(u),this.emit("completed",u)}catch(f){o(f),this.emit("error",f)}v(this,Y,"m",Yd).call(this)};v(this,De,"f").enqueue(i,t),v(this,Y,"m",Qo).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return v(this,bt,"f")?(j(this,bt,!1,"f"),v(this,Y,"m",Yo).call(this),this):this}pause(){j(this,bt,!0,"f")}clear(){j(this,De,new(v(this,Wo,"f")),"f")}async onEmpty(){v(this,De,"f").size!==0&&await v(this,Y,"m",Go).call(this,"empty")}async onSizeLessThan(e){v(this,De,"f").size<e||await v(this,Y,"m",Go).call(this,"next",()=>v(this,De,"f").size<e)}async onIdle(){v(this,xe,"f")===0&&v(this,De,"f").size===0||await v(this,Y,"m",Go).call(this,"idle")}get size(){return v(this,De,"f").size}sizeBy(e){return v(this,De,"f").filter(e).length}get pending(){return v(this,xe,"f")}get isPaused(){return v(this,bt,"f")}};Sn=new WeakMap,Tn=new WeakMap,vt=new WeakMap,Jo=new WeakMap,In=new WeakMap,Ko=new WeakMap,Fe=new WeakMap,Cn=new WeakMap,De=new WeakMap,Wo=new WeakMap,xe=new WeakMap,On=new WeakMap,bt=new WeakMap,Ho=new WeakMap,Y=new WeakSet,Wd=function(){return v(this,Tn,"f")||v(this,vt,"f")<v(this,Jo,"f")},Hd=function(){return v(this,xe,"f")<v(this,On,"f")},Yd=function(){var e;j(this,xe,(e=v(this,xe,"f"),e--,e),"f"),v(this,Y,"m",Qo).call(this),this.emit("next")},Qd=function(){this.emit("empty"),v(this,xe,"f")===0&&this.emit("idle")},Gd=function(){v(this,Y,"m",ya).call(this),v(this,Y,"m",ma).call(this),j(this,Cn,void 0,"f")},Jd=function(){let e=Date.now();if(v(this,Fe,"f")===void 0){let t=v(this,Ko,"f")-e;if(t<0)j(this,vt,v(this,Sn,"f")?v(this,xe,"f"):0,"f");else return v(this,Cn,"f")===void 0&&j(this,Cn,setTimeout(()=>{v(this,Y,"m",Gd).call(this)},t),"f"),!0}return!1},Qo=function(){if(v(this,De,"f").size===0)return v(this,Fe,"f")&&clearInterval(v(this,Fe,"f")),j(this,Fe,void 0,"f"),v(this,Y,"m",Qd).call(this),!1;if(!v(this,bt,"f")){let e=!v(this,Y,"a",Jd);if(v(this,Y,"a",Wd)&&v(this,Y,"a",Hd)){let t=v(this,De,"f").dequeue();return t?(this.emit("active"),t(),e&&v(this,Y,"m",ma).call(this),!0):!1}}return!1},ma=function(){v(this,Tn,"f")||v(this,Fe,"f")!==void 0||(j(this,Fe,setInterval(()=>{v(this,Y,"m",ya).call(this)},v(this,In,"f")),"f"),j(this,Ko,Date.now()+v(this,In,"f"),"f"))},ya=function(){v(this,vt,"f")===0&&v(this,xe,"f")===0&&v(this,Fe,"f")&&(clearInterval(v(this,Fe,"f")),j(this,Fe,void 0,"f")),j(this,vt,v(this,Sn,"f")?v(this,xe,"f"):0,"f"),v(this,Y,"m",Yo).call(this)},Yo=function(){for(;v(this,Y,"m",Qo).call(this););},Go=async function(e,t){return new Promise(n=>{let o=()=>{t&&!t()||(this.off(e,o),n())};this.on(e,o)})};var wa=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},ba=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},Zd=r=>globalThis.DOMException===void 0?new ba(r):new DOMException(r),eh=r=>{let e=r.reason===void 0?Zd("This operation was aborted."):r.reason;return e instanceof Error?e:Zd(e)};function va(r,e){let{milliseconds:t,fallback:n,message:o,customTimers:i={setTimeout,clearTimeout}}=e,s,a=new Promise((c,f)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){c(r);return}if(e.signal){let{signal:u}=e;u.aborted&&f(eh(u)),u.addEventListener("abort",()=>{f(eh(u))})}s=i.setTimeout.call(void 0,()=>{if(n){try{c(n())}catch(p){f(p)}return}let u=typeof o=="string"?o:`Promise timed out after ${t} milliseconds`,l=o instanceof Error?o:new wa(u);typeof r.cancel=="function"&&r.cancel(),f(l)},t),(async()=>{try{c(await r)}catch(u){f(u)}finally{i.clearTimeout.call(void 0,s)}})()});return a.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},a}var Ea="lock:worker:request-read",Da="lock:worker:release-read",xa="lock:master:grant-read",_a="lock:worker:request-write",Aa="lock:worker:release-write",Ca="lock:master:grant-write";var Et={},Or=r=>{r.addEventListener("message",e=>{Or.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Or.dispatchEvent("message",r,e)})};Or.addEventListener=(r,e)=>{Et[r]==null&&(Et[r]=[]),Et[r].push(e)};Or.removeEventListener=(r,e)=>{Et[r]!=null&&(Et[r]=Et[r].filter(t=>t===e))};Or.dispatchEvent=function(r,e,t){Et[r]!=null&&Et[r].forEach(n=>n(e,t))};var Sa=Or;var th=(r,e,t,n,o)=>(i,s)=>{if(s.data.type!==t)return;let a={type:s.data.type,name:s.data.name,identifier:s.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>(i.postMessage({type:o,name:a.name,identifier:a.identifier}),await new Promise(c=>{let f=u=>{if(u==null||u.data==null)return;let l={type:u.data.type,name:u.data.name,identifier:u.data.identifier};l.type===n&&l.identifier===a.identifier&&(i.removeEventListener("message",f),c())};i.addEventListener("message",f)}))}}))},rh=(r,e,t,n)=>async()=>{let o=Mn();return globalThis.postMessage({type:e,identifier:o,name:r}),await new Promise(i=>{let s=a=>{if(a==null||a.data==null)return;let c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===o&&(globalThis.removeEventListener("message",s),i(()=>{globalThis.postMessage({type:n,identifier:o,name:r})}))};globalThis.addEventListener("message",s)})},zw={singleProcess:!1},nh=r=>{if(r=Object.assign({},zw,r),Boolean(globalThis.document)||r.singleProcess){let t=new EventTarget;return Sa.addEventListener("message",th(t,"requestReadLock",Ea,Da,xa)),Sa.addEventListener("message",th(t,"requestWriteLock",_a,Aa,Ca)),t}return{isWorker:!0,readLock:t=>rh(t,Ea,xa,Da),writeLock:t=>rh(t,_a,Ca,Aa)}};var qt={},Dt;async function Ta(r,e){let t,n=new Promise(o=>{t=o});return r.add(async()=>await va((async()=>await new Promise(o=>{t(()=>{o()})}))(),{milliseconds:e.timeout})),await n}var jw=(r,e)=>{if(Dt.isWorker===!0)return{readLock:Dt.readLock(r,e),writeLock:Dt.writeLock(r,e)};let t=new Ir({concurrency:1}),n;return{async readLock(){if(n!=null)return await Ta(n,e);n=new Ir({concurrency:e.concurrency,autoStart:!1});let o=n,i=Ta(n,e);return t.add(async()=>(o.start(),await o.onIdle().then(()=>{n===o&&(n=null)}))),await i},async writeLock(){return n=null,await Ta(t,e)}}},qw={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Ia(r){let e=Object.assign({},qw,r);return Dt==null&&(Dt=nh(e),Dt.isWorker!==!0&&(Dt.addEventListener("requestReadLock",t=>{qt[t.data.name]!=null&&qt[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),Dt.addEventListener("requestWriteLock",async t=>{qt[t.data.name]!=null&&qt[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),qt[e.name]==null&&(qt[e.name]=jw(e.name,e)),qt[e.name]}var yh=S(Me(),1);async function*Oa(r,e=1){let t=[];e<1&&(e=1);for await(let n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}async function*Pa(r,e=1){for await(let t of Oa(r,e)){let n=t.map(async o=>await o().then(i=>({ok:!0,value:i}),i=>({ok:!1,err:i})));for(let o=0;o<n.length;o++){let i=await n[o];if(i.ok)yield i.value;else throw i.err}}}var hh=S(dh(),1),Ww=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},ph=r=>r!=null&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),Na=r=>r!=null&&typeof r.sink=="function"&&ph(r.source),Hw=r=>e=>{let t=r.sink(e);if(t.then!=null){let n=Sr({objectMode:!0});return t.then(()=>{n.end()},i=>{n.end(i)}),(0,hh.default)(n,async function*(){yield*r.source,n.end()}())}return r.source};function mh(r,...e){if(Na(r)){let n=r;r=()=>n.source}else if(ph(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&Na(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)Na(t[n])&&(t[n]=Hw(t[n]));return Ww(...t)}async function*Xo(...r){let e=Sr({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(let n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}var Pn=(0,yh.default)("ipfs:repo:gc"),Qw=en().code,Gw=256,Jw=new D("/local/filesroot");function gh({gcLock:r,pins:e,blockstore:t,root:n,loadCodec:o}){async function*i(){let s=Date.now();Pn("Creating set of marked blocks");let a=await r.writeLock();try{let c=await Yw({pins:e,blockstore:t,root:n,loadCodec:o}),f=t.queryKeys({});yield*Xw({blockstore:t},c,f),Pn(`Complete (${Date.now()-s}ms)`)}finally{a()}}return i}async function Yw({pins:r,blockstore:e,loadCodec:t,root:n}){let o=async function*(){let a;try{a=await n.get(Jw)}catch(f){if(f.code===Qw){Pn("No blocks in MFS");return}throw f}let c=A.decode(a);yield c,yield*Tr(c,e,t)}(),i=Xo(zt(r.recursiveKeys(),({cid:a})=>a),r.indirectKeys(),zt(r.directKeys(),({cid:a})=>a),o),s=new Set;for await(let a of Xo(i,o))s.add(ae.encode(a.multihash.bytes));return s}async function*Xw({blockstore:r},e,t){let n=0,o=0;yield*mh(Pa(zt(t,async s=>async function(){n++;try{let c=ae.encode(s.multihash.bytes);if(e.has(c))return null;try{await r.delete(s),o++}catch(f){return{err:new Error(`Could not delete block with CID ${s}: ${f.message}`)}}return{cid:s}}catch(c){let f=`Could delete block with CID ${s}`;return Pn(f,c),{err:new Error(f+`: ${c.message}`)}}}),Gw),s=>bn(s,Boolean)),Pn(`Marked set has ${e.size} unique blocks. Blockstore has ${n} blocks. Deleted ${o} blocks.`)}var de=(0,bh.default)("ipfs:repo"),Zw=Number.MAX_SAFE_INTEGER,eb="repoAutoMigrate",Ra=class{constructor(e,t,n,o){if(typeof e!="string")throw new Error("missing repo path");if(typeof t!="function")throw new Error("missing codec loader");this.options=ud(Ld,o),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;let i=n.blocks,s=n.pins;this.pins=new Vo({pinstore:s,blockstore:i,loadCodec:t});let a=qd(this.pins,i);this.blocks=Pd(a),this.version=pd(this.root),this.config=Sd(this.root),this.spec=Td(this.root),this.apiAddr=Id(this.root),this.gcLock=Ia({name:e,singleProcess:this.options.repoOwner!==!1}),this.gc=gh({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){de("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(rb(e)),await this.spec.set(nb(e)),await this.version.set(12)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch{return!1}}async open(){if(!this.closed)throw(0,Vt.default)(new Error("repo is already open"),fd);de("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),de("acquired repo.lock"),!await this.version.check(12))if(await this._isAutoMigrationEnabled())await this._migrate(12,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys});else throw new Mt("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");de("creating datastore"),await this.datastore.open(),de("creating blocks"),await this.blocks.open(),de("creating keystore"),await this.keys.open(),de("creating pins"),await this.pins.pinstore.open(),this.closed=!1,de("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){de("error removing lock",t)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if(e.message!=="Already open")throw e}}async _openLock(){let e=await this.options.repoLock.lock(this.path);if(typeof e.close!="function")throw(0,Vt.default)(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){de("init check");let e;try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(t){throw t.code==="ERR_NOT_FOUND"?(0,Vt.default)(new Error("repo is not initialized yet"),un,{path:this.path}):t}if(!e)throw(0,Vt.default)(new Error("repo is not initialized yet"),un,{path:this.path})}async close(){if(this.closed)throw(0,Vt.default)(new Error("repo is already closed"),ld);de("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==un&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map(e=>e&&e.close())),de("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){let[e,t,n,o,i]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),wh(this.datastore),wh(this.keys)]),s=t.size+o+i;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:s}}throw(0,Vt.default)(new Error("repo is not initialized yet"),un,{path:this.path})}async _isAutoMigrationEnabled(){if(this.options.autoMigrate!==void 0)return this.options.autoMigrate;let e;try{e=await this.config.get(eb)}catch(t){if(t.code===be.code)e=!0;else throw t}return e}async _migrate(e,t){return await this.version.get()>e?(de(`reverting to version ${e}`),Gl(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(de(`migrating to version ${e}`),Ql(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{let e=await this.config.get("Datastore.StorageMax");return BigInt((0,vh.default)(e))}catch{return BigInt(Zw)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(let{key:n,value:o}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(o.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}};async function wh(r){let e=BigInt(0);for await(let t of r.query({}))e+=BigInt(t.value.byteLength),e+=BigInt(t.key.uint8Array().byteLength);return e}function tb(r,e,t,n){return new Ra(r,e,t,n)}function rb(r){return r.Datastore=Object.assign({},aa,Pr(r,"datastore")),r}function nb(r){let e={...aa.Spec,...Pr(r,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map(t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc}))}}return Ch(ob);})();
/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */
return IpfsRepo}));
